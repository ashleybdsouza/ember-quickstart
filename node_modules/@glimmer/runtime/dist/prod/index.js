import{debug as e,logOpcode as t,recordStackSize as n,opcodeMetadata as s,check as i,CheckPrimitive as r,CheckNumber as a,CheckOption as o,CheckHandle as l,CheckBlockSymbolTable as c,CheckInstanceof as u,CheckString as d,CheckElement as p,CheckMaybe as h,CheckNode as m,CheckOr as f,CheckProgramSymbolTable as g,CheckInterface as b,CheckFunction as y,wrap as k,CheckArray as v,CheckDict as w,CheckUnknown as S,CheckObject as E,CheckSafeString as x,CheckDocumentFragment as C,CheckBoolean as T,CheckUndefined as N}from"@glimmer/debug";import{UNDEFINED_REFERENCE as B,valueForRef as _,createComputeRef as A,createConstRef as R,createPrimitiveRef as M,isConstRef as L,NULL_REFERENCE as O,TRUE_REFERENCE as D,FALSE_REFERENCE as V,REFERENCE as U,createDebugAliasRef as I,childRefFor as $,createIteratorRef as H,isInvokableRef as j,updateRef as G,createIteratorItemRef as P}from"@glimmer/reference";import{assign as F,unwrap as W,expect as z,NS_SVG as Y,castToBrowser as J,Stack as q,assert as K,LOCAL_LOGGER as X,isObject as Q,decodeHandle as Z,isHandle as ee,decodeImmediate as te,debugToString as ne,EMPTY_STRING_ARRAY as se,dict as ie,unwrapTemplate as re,enumerate as ae,emptyArray as oe,INSERT_BEFORE_END as le,INSERT_BEFORE_BEGIN as ce,clearElement as ue,INSERT_AFTER_BEGIN as de,castToSimple as pe,buildUntouchableThis as he,isDict as me,logStep as fe,unwrapHandle as ge,reverse as be,COMMENT_NODE as ye}from"@glimmer/util";import{Op as ke,$pc as ve,$sp as we,$ra as Se,$fp as Ee,CurriedTypes as xe,$t0 as Ce,$t1 as Te,InternalComponentCapabilities as Ne,$v0 as Be,ContentType as _e,CurriedType as Ae,MachineOp as Re,isLowLevelRegister as Me,$s1 as Le,$s0 as Oe}from"@glimmer/vm";import{registerDestructor as De,destroy as Ve,associateDestroyableChild as Ue,_hasDestroyableChildren as Ie,isDestroying as $e,isDestroyed as He,destroyChildren as je}from"@glimmer/destroyable";export{destroy,isDestroyed,isDestroying,registerDestructor}from"@glimmer/destroyable";import{warnIfStyleNotTrusted as Ge,toBool as Pe,getPath as Fe,setPath as We,assertGlobalContextWasSet as ze}from"@glimmer/global-context";import{getInternalModifierManager as Ye,managerHasCapability as Je,getInternalHelperManager as qe,hasInternalComponentManager as Ke,hasInternalHelperManager as Xe,setInternalComponentManager as Qe,setInternalHelperManager as Ze,hasValue as et,hasDestroyable as tt,setInternalModifierManager as nt}from"@glimmer/manager";import{beginTrackFrame as st,endTrackFrame as it,CONSTANT_TAG as rt,INITIAL as at,validateTag as ot,consumeTag as lt,valueForTag as ct,CURRENT_TAG as ut,COMPUTE as dt,track as pt,updateTag as ht,createCache as mt,getValue as ft,createUpdatableTag as gt,debug as bt,resetTracking as yt}from"@glimmer/validator";import{RuntimeProgramImpl as kt}from"@glimmer/program";import{getOwner as vt}from"@glimmer/owner";const wt=!("undefined"!=typeof window&&window.location&&/[&?]disable_local_debug/u.test(window.location.search)),St=!("undefined"==typeof window||!window.location||!/[&?]enable_local_should_log/u.test(window.location.search));class Et{bucket;constructor(e){this.bucket=e?F({},e):{}}get(e){return W(this.bucket[e])}set(e,t){return this.bucket[e]=t}child(){return new Et(this.bucket)}}class xt{static root(e,t=0,n){let s=new Array(t+1).fill(B);return new xt(s,n,null,null,null).init({self:e})}static sized(e=0,t){let n=new Array(e+1).fill(B);return new xt(n,t,null,null,null)}constructor(e,t,n,s,i){this.slots=e,this.owner=t,this.callerScope=n,this.evalScope=s,this.partialMap=i}init({self:e}){return this.slots[0]=e,this}getSelf(){return this.get(0)}getSymbol(e){return this.get(e)}getBlock(e){let t=this.get(e);return t===B?null:t}getEvalScope(){return this.evalScope}getPartialMap(){return this.partialMap}bind(e,t){this.set(e,t)}bindSelf(e){this.set(0,e)}bindSymbol(e,t){this.set(e,t)}bindBlock(e,t){this.set(e,t)}bindEvalScope(e){this.evalScope=e}bindPartialMap(e){this.partialMap=e}bindCallerScope(e){this.callerScope=e}getCallerScope(){return this.callerScope}child(){return new xt(this.slots.slice(),this.owner,this.callerScope,this.evalScope,this.partialMap)}get(e){if(e>=this.slots.length)throw new RangeError(`BUG: cannot get $${e} from scope; length=${this.slots.length}`);return this.slots[e]}set(e,t){if(e>=this.slots.length)throw new RangeError(`BUG: cannot get $${e} from scope; length=${this.slots.length}`);this.slots[e]=t}}const Ct=Symbol("INNER_VM"),Tt=Symbol("DESTROYABLE_STACK"),Nt=Symbol("STACKS"),Bt=Symbol("REGISTERS"),_t=Symbol("HEAP"),At=Symbol("CONSTANTS"),Rt=Symbol("ARGS");class Mt{constructor(e,t){this.element=e,this.nextSibling=t}}class Lt{constructor(e,t,n){this.parentNode=e,this.first=t,this.last=n}parentElement(){return this.parentNode}firstNode(){return this.first}lastNode(){return this.last}}function Ot(e,t){let n=e.parentElement(),s=e.firstNode(),i=e.lastNode(),r=s;for(;;){let e=r.nextSibling;if(n.insertBefore(r,t),r===i)return e;r=z(e,"invalid bounds")}}function Dt(e){let t=e.parentElement(),n=e.firstNode(),s=e.lastNode(),i=n;for(;;){let e=i.nextSibling;if(t.removeChild(i),i===s)return e;i=z(e,"invalid bounds")}}function Vt(e){return Ut(e)?"":String(e)}function Ut(e){return null==e||"function"!=typeof e.toString}function It(e){return"object"==typeof e&&null!==e&&"function"==typeof e.toHTML}function $t(e){return"object"==typeof e&&null!==e&&"number"==typeof e.nodeType}function Ht(e){return"string"==typeof e}function jt(e,t){let n,s;if(t in e)s=t,n="prop";else{let i=t.toLowerCase();i in e?(n="prop",s=i):(n="attr",s=t)}return"prop"!==n||"style"!==s.toLowerCase()&&!function(e,t){let n=Gt[e.toUpperCase()];return n&&n[t.toLowerCase()]||!1}(e.tagName,s)||(n="attr"),{normalized:s,type:n}}const Gt={INPUT:{form:!0,autocorrect:!0,list:!0},SELECT:{form:!0},OPTION:{form:!0},TEXTAREA:{form:!0},LABEL:{form:!0},FIELDSET:{form:!0},LEGEND:{form:!0},OBJECT:{form:!0},OUTPUT:{form:!0},BUTTON:{form:!0}};const Pt=["javascript:","vbscript:"],Ft=["A","BODY","LINK","IMG","IFRAME","BASE","FORM"],Wt=["EMBED"],zt=["href","src","background","action"],Yt=["src"];function Jt(e,t){return-1!==e.indexOf(t)}function qt(e,t){return(null===e||Jt(Ft,e))&&Jt(zt,t)}function Kt(e,t){return null!==e&&(Jt(Wt,e)&&Jt(Yt,t))}function Xt(e,t){return qt(e,t)||Kt(e,t)}let Qt,Zt;function en(e){return Qt||(Qt=function(){if("object"==typeof URL&&null!==URL&&"function"==typeof URL.parse){let e=URL;return t=>{let n=null;return"string"==typeof t&&(n=e.parse(t).protocol),null===n?":":n}}if("function"==typeof URL)return e=>{try{return new URL(e).protocol}catch(e){return":"}};throw new Error('@glimmer/runtime needs a valid "globalThis.URL"')}()),Qt(e)}function tn(e,t,n){let s=null;if(null==n)return n;if(It(n))return n.toHTML();s=e?e.tagName.toUpperCase():null;let i=Vt(n);if(qt(s,t)){let e=en(i);if(Jt(Pt,e))return`unsafe:${i}`}return Kt(s,t)?`unsafe:${i}`:i}function nn(e,t,n,s=!1){const{tagName:i,namespaceURI:r}=e,a={element:e,name:t,namespace:n};if("style"===t&&!s)return new Zt(a);if(r===Y)return sn(i,t,a);const{type:o,normalized:l}=jt(e,t);return"attr"===o?sn(i,l,a):function(e,t,n){if(Xt(e,t))return new ln(t,n);if(function(e,t){return("INPUT"===e||"TEXTAREA"===e)&&"value"===t}(e,t))return new un(t,n);if(function(e,t){return"OPTION"===e&&"selected"===t}(e,t))return new dn(t,n);return new on(t,n)}(i,l,a)}function sn(e,t,n){return Xt(e,t)?new cn(n):new an(n)}class rn{constructor(e){this.attribute=e}}class an extends rn{set(e,t,n){const s=pn(t);if(null!==s){const{name:t,namespace:n}=this.attribute;e.__setAttribute(t,s,n)}}update(e,t){const n=pn(e),{element:s,name:i}=this.attribute;null===n?s.removeAttribute(i):s.setAttribute(i,n)}}class on extends rn{constructor(e,t){super(t),this.normalizedName=e}value;set(e,t,n){null!=t&&(this.value=t,e.__setProperty(this.normalizedName,t))}update(e,t){const{element:n}=this.attribute;this.value!==e&&(n[this.normalizedName]=this.value=e,null==e&&this.removeAttribute())}removeAttribute(){const{element:e,namespace:t}=this.attribute;t?e.removeAttributeNS(t,this.normalizedName):e.removeAttribute(this.normalizedName)}}class ln extends on{set(e,t,n){const{element:s,name:i}=this.attribute,r=tn(s,i,t);super.set(e,r,n)}update(e,t){const{element:n,name:s}=this.attribute,i=tn(n,s,e);super.update(i,t)}}class cn extends an{set(e,t,n){const{element:s,name:i}=this.attribute,r=tn(s,i,t);super.set(e,r,n)}update(e,t){const{element:n,name:s}=this.attribute,i=tn(n,s,e);super.update(i,t)}}class un extends on{set(e,t){e.__setProperty("value",Vt(t))}update(e){const t=J(this.attribute.element,["input","textarea"]),n=t.value,s=Vt(e);n!==s&&(t.value=s)}}class dn extends on{set(e,t){null!=t&&!1!==t&&e.__setProperty("selected",!0)}update(e){const t=J(this.attribute.element,"option");t.selected=!!e}}function pn(e){return!1===e||null==e||void 0===e.toString?null:!0===e?"":"function"==typeof e?null:String(e)}Zt=class extends an{set(e,t,n){Ge(t),super.set(e,t,n)}update(e,t){Ge(e),super.update(e,t)}};class hn{constructor(e){this.node=e}firstNode(){return this.node}}class mn{constructor(e){this.node=e}lastNode(){return this.node}}const fn=Symbol("CURSOR_STACK");class gn{dom;updateOperations;constructing=null;operations=null;env;[fn]=new q;modifierStack=new q;blockStack=new q;static forInitialRender(e,t){return new this(e,t.element,t.nextSibling).initialize()}static resume(e,t){let n=new this(e,t.parentElement(),t.reset(e)).initialize();return n.pushLiveBlock(t),n}constructor(e,t,n){this.pushElement(t,n),this.env=e,this.dom=e.getAppendOperations(),this.updateOperations=e.getDOM()}initialize(){return this.pushSimpleBlock(),this}debugBlocks(){return this.blockStack.toArray()}get element(){return this[fn].current.element}get nextSibling(){return this[fn].current.nextSibling}get hasBlocks(){return this.blockStack.size>0}block(){return z(this.blockStack.current,"Expected a current live block")}popElement(){this[fn].pop(),z(this[fn].current,"can't pop past the last element")}pushSimpleBlock(){return this.pushLiveBlock(new bn(this.element))}pushUpdatableBlock(){return this.pushLiveBlock(new kn(this.element))}pushBlockList(e){return this.pushLiveBlock(new vn(this.element,e))}pushLiveBlock(e,t=!1){let n=this.blockStack.current;return null!==n&&(t||n.didAppendBounds(e)),this.__openBlock(),this.blockStack.push(e),e}popBlock(){return this.block().finalize(this),this.__closeBlock(),z(this.blockStack.pop(),"Expected popBlock to return a block")}__openBlock(){}__closeBlock(){}openElement(e){let t=this.__openElement(e);return this.constructing=t,t}__openElement(e){return this.dom.createElement(e,this.element)}flushElement(e){let t=this.element,n=z(this.constructing,"flushElement should only be called when constructing an element");this.__flushElement(t,n),this.constructing=null,this.operations=null,this.pushModifiers(e),this.pushElement(n,null),this.didOpenElement(n)}__flushElement(e,t){this.dom.insertBefore(e,t,this.nextSibling)}closeElement(){return this.willCloseElement(),this.popElement(),this.popModifiers()}pushRemoteElement(e,t,n){return this.__pushRemoteElement(e,t,n)}__pushRemoteElement(e,t,n){if(this.pushElement(e,n),void 0===n)for(;e.lastChild;)e.removeChild(e.lastChild);let s=new yn(e);return this.pushLiveBlock(s,!0)}popRemoteElement(){const e=this.popBlock();return K(e instanceof yn,"[BUG] expecting a RemoteLiveBlock"),this.popElement(),e}pushElement(e,t=null){this[fn].push(new Mt(e,t))}pushModifiers(e){this.modifierStack.push(e)}popModifiers(){return this.modifierStack.pop()}didAppendBounds(e){return this.block().didAppendBounds(e),e}didAppendNode(e){return this.block().didAppendNode(e),e}didOpenElement(e){return this.block().openElement(e),e}willCloseElement(){this.block().closeElement()}appendText(e){return this.didAppendNode(this.__appendText(e))}__appendText(e){let{dom:t,element:n,nextSibling:s}=this,i=t.createTextNode(e);return t.insertBefore(n,i,s),i}__appendNode(e){return this.dom.insertBefore(this.element,e,this.nextSibling),e}__appendFragment(e){let t=e.firstChild;if(t){let n=new Lt(this.element,t,e.lastChild);return this.dom.insertBefore(this.element,e,this.nextSibling),n}{const e=this.__appendComment("");return new Lt(this.element,e,e)}}__appendHTML(e){return this.dom.insertHTMLBefore(this.element,this.nextSibling,e)}appendDynamicHTML(e){let t=this.trustedContent(e);this.didAppendBounds(t)}appendDynamicText(e){let t=this.untrustedContent(e);return this.didAppendNode(t),t}appendDynamicFragment(e){let t=this.__appendFragment(e);this.didAppendBounds(t)}appendDynamicNode(e){let t=this.__appendNode(e),n=new Lt(this.element,t,t);this.didAppendBounds(n)}trustedContent(e){return this.__appendHTML(e)}untrustedContent(e){return this.__appendText(e)}appendComment(e){return this.didAppendNode(this.__appendComment(e))}__appendComment(e){let{dom:t,element:n,nextSibling:s}=this,i=t.createComment(e);return t.insertBefore(n,i,s),i}__setAttribute(e,t,n){this.dom.setAttribute(this.constructing,e,t,n)}__setProperty(e,t){this.constructing[e]=t}setStaticAttribute(e,t,n){this.__setAttribute(e,t,n)}setDynamicAttribute(e,t,n,s){let i=nn(this.constructing,e,s,n);return i.set(this,t,this.env),i}}class bn{first=null;last=null;nesting=0;constructor(e){this.parent=e}parentElement(){return this.parent}firstNode(){return z(this.first,"cannot call `firstNode()` while `SimpleLiveBlock` is still initializing").firstNode()}lastNode(){return z(this.last,"cannot call `lastNode()` while `SimpleLiveBlock` is still initializing").lastNode()}openElement(e){this.didAppendNode(e),this.nesting++}closeElement(){this.nesting--}didAppendNode(e){0===this.nesting&&(this.first||(this.first=new hn(e)),this.last=new mn(e))}didAppendBounds(e){0===this.nesting&&(this.first||(this.first=e),this.last=e)}finalize(e){null===this.first&&e.appendComment("")}}class yn extends bn{constructor(e){super(e),De(this,(()=>{this.parentElement()===this.firstNode().parentNode&&Dt(this)}))}}class kn extends bn{reset(){Ve(this);let e=Dt(this);return this.first=null,this.last=null,this.nesting=0,e}}class vn{constructor(e,t){this.parent=e,this.boundList=t,this.parent=e,this.boundList=t}parentElement(){return this.parent}firstNode(){return z(this.boundList[0],"cannot call `firstNode()` while `LiveBlockList` is still initializing").firstNode()}lastNode(){let e=this.boundList;return z(e[e.length-1],"cannot call `lastNode()` while `LiveBlockList` is still initializing").lastNode()}openElement(e){K(!1,"Cannot openElement directly inside a block list")}closeElement(){K(!1,"Cannot closeElement directly inside a block list")}didAppendNode(e){K(!1,"Cannot create a new node directly inside a block list")}didAppendBounds(e){}finalize(e){K(this.boundList.length>0,"boundsList cannot be empty")}}function wn(e,t){return gn.forInitialRender(e,t)}const Sn=new class{evaluateOpcode=new Array(ke.Size).fill(null);add(e,t,n="syscall"){this.evaluateOpcode[e]={syscall:"machine"!==n,evaluate:t}}debugBefore(s,i){let r,a,o;if(St){let n=s[Ct].fetchRegister(ve)-i.size;[a,r]=e(s[At],i,i.isMachine),X.log(`${n}. ${t(a,r)}`);let o=[];for(let e in r)o.push(e,"=",r[e]);X.log(...o)}return wt&&(o=s.fetchValue(we)),n(s.fetchValue(we)),{sp:o,pc:s.fetchValue(ve),name:a,params:r,type:i.type,isMachine:i.isMachine,size:i.size,state:void 0}}debugAfter(e,n){let{sp:i,type:r,isMachine:a,pc:o}=n;if(wt){let l=s(r,a),c=e.fetchValue(we)-i;if(l&&l.check&&"number"==typeof l.stackChange&&l.stackChange!==c)throw new Error(`Error in ${n.name}:\n\n${o}. ${t(n.name,n.params)}\n\nStack changed by ${c}, expected ${l.stackChange}`);St&&(X.log("%c -> pc: %d, ra: %d, fp: %d, sp: %d, s0: %O, s1: %O, t0: %O, t1: %O, v0: %O","color: orange",e[Ct].registers[ve],e[Ct].registers[Se],e[Ct].registers[Ee],e[Ct].registers[we],e.s0,e.s1,e.t0,e.t1,e.v0),X.log("%c -> eval stack","color: red",e.stack.toArray()),X.log("%c -> block stack","color: magenta",e.elements().debugBlocks()),X.log("%c -> destructor stack","color: violet",e[Tt].toArray()),null===e[Nt].scope.current?X.log("%c -> scope","color: green","null"):X.log("%c -> scope","color: green",e.scope().slots.map((e=>function(e){return null!==e&&!Array.isArray(e)}(e)?_(e):e))),X.log("%c -> elements","color: blue",e.elements()[fn].current.element),X.log("%c -> constructing","color: aqua",e.elements().constructing))}}evaluate(e,t,n){let s=W(this.evaluateOpcode[n]);s.syscall?(K(!t.isMachine,`BUG: Mismatch between operation.syscall (${s.syscall}) and opcode.isMachine (${t.isMachine}) for ${t.type}`),s.evaluate(e,t)):(K(t.isMachine,`BUG: Mismatch between operation.syscall (${s.syscall}) and opcode.isMachine (${t.isMachine}) for ${t.type}`),s.evaluate(e[Ct],t))}},En=Symbol("TYPE"),xn=Symbol("INNER"),Cn=Symbol("OWNER"),Tn=Symbol("ARGS"),Nn=Symbol("RESOLVED"),Bn=new WeakSet;function _n(e){return Bn.has(e)}function An(e,t){return _n(e)&&e[En]===t}class Rn{[En];[xn];[Cn];[Tn];[Nn];constructor(e,t,n,s,i=!1){Bn.add(this),this[En]=e,this[xn]=t,this[Cn]=n,this[Tn]=s,this[Nn]=i}}function Mn(e){let t,n,s,i,r,a=e;for(;;){let{[Tn]:e,[xn]:o}=a;if(null!==e){let{named:s,positional:i}=e;i.length>0&&(t=void 0===t?i:i.concat(t)),void 0===n&&(n=[]),n.unshift(s)}if(!_n(o)){s=o,i=a[Cn],r=a[Nn];break}a=o}return{definition:s,owner:i,resolved:r,positional:t,named:n}}function Ln(e,t,n,s,i=!1){return new Rn(e,t,n,s,i)}function On(e){return"getDebugCustomRenderTree"in e}Sn.add(ke.ChildScope,(e=>e.pushChildScope())),Sn.add(ke.PopScope,(e=>e.popScope())),Sn.add(ke.PushDynamicScope,(e=>e.pushDynamicScope())),Sn.add(ke.PopDynamicScope,(e=>e.popDynamicScope())),Sn.add(ke.Constant,((e,{op1:t})=>{e.stack.push(e[At].getValue(Z(t)))})),Sn.add(ke.ConstantReference,((e,{op1:t})=>{e.stack.push(R(e[At].getValue(Z(t)),!1))})),Sn.add(ke.Primitive,((e,{op1:t})=>{let n=e.stack;if(ee(t)){let s=e[At].getValue(Z(t));n.push(s)}else n.push(te(t))})),Sn.add(ke.PrimitiveReference,(e=>{let t,n=e.stack,s=i(n.pop(),r);t=void 0===s?B:null===s?O:!0===s?D:!1===s?V:M(s),n.push(t)})),Sn.add(ke.Dup,((e,{op1:t,op2:n})=>{let s=i(e.fetchValue(t),a)-n;e.stack.dup(s)})),Sn.add(ke.Pop,((e,{op1:t})=>{e.stack.pop(t)})),Sn.add(ke.Load,((e,{op1:t})=>{e.load(t)})),Sn.add(ke.Fetch,((e,{op1:t})=>{e.fetch(t)})),Sn.add(ke.BindDynamicScope,((e,{op1:t})=>{let n=e[At].getArray(t);e.bindDynamicScope(n)})),Sn.add(ke.Enter,((e,{op1:t})=>{e.enter(t)})),Sn.add(ke.Exit,(e=>{e.exit()})),Sn.add(ke.PushSymbolTable,((e,{op1:t})=>{e.stack.push(e[At].getValue(t))})),Sn.add(ke.PushBlockScope,(e=>{e.stack.push(e.scope())})),Sn.add(ke.CompileBlock,(e=>{let t=e.stack,n=t.pop();n?t.push(e.compile(n)):t.push(null)})),Sn.add(ke.InvokeYield,(e=>{let{stack:t}=e,n=i(t.pop(),o(l)),s=i(t.pop(),o(is)),r=i(t.pop(),o(c));K(null===r||r&&"object"==typeof r&&Array.isArray(r.parameters),`Expected top of stack to be ${"Option<BlockSymbolTable>"}, was ${String(r)}`);let a=i(t.pop(),u(fs));if(null===r)return e.pushFrame(),void e.pushScope(s??e.scope());let d=z(s,"BUG: expected scope");{let e=r.parameters,t=e.length;if(t>0){d=d.child();for(let n=0;n<t;n++)d.bindSymbol(W(e[n]),a.at(n))}}e.pushFrame(),e.pushScope(d),e.call(n)})),Sn.add(ke.JumpIf,((e,{op1:t})=>{let n=i(e.stack.pop(),Qn),s=Boolean(_(n));L(n)?!0===s&&e.goto(t):(!0===s&&e.goto(t),e.updateWith(new Dn(n)))})),Sn.add(ke.JumpUnless,((e,{op1:t})=>{let n=i(e.stack.pop(),Qn),s=Boolean(_(n));L(n)?!1===s&&e.goto(t):(!1===s&&e.goto(t),e.updateWith(new Dn(n)))})),Sn.add(ke.JumpEq,((e,{op1:t,op2:n})=>{i(e.stack.peek(),a)===n&&e.goto(t)})),Sn.add(ke.AssertSame,(e=>{let t=i(e.stack.peek(),Qn);!1===L(t)&&e.updateWith(new Dn(t))})),Sn.add(ke.ToBoolean,(e=>{let{stack:t}=e,n=i(t.pop(),Qn);t.push(A((()=>Pe(_(n)))))}));class Dn{last;constructor(e){this.ref=e,this.last=_(e)}evaluate(e){let{last:t,ref:n}=this;t!==_(n)&&e.throw()}}class Vn{last;constructor(e,t){this.ref=e,this.filter=t,this.last=t(_(e))}evaluate(e){let{last:t,ref:n,filter:s}=this;t!==s(_(n))&&e.throw()}}class Un{tag=rt;lastRevision=at;target;finalize(e,t){this.target=t,this.didModify(e)}evaluate(e){let{tag:t,target:n,lastRevision:s}=this;!e.alwaysRevalidate&&ot(t,s)&&(lt(t),e.goto(z(n,"VM BUG: Target must be set before attempting to jump")))}didModify(e){this.tag=e,this.lastRevision=ct(this.tag),lt(e)}}class In{constructor(e){this.debugLabel=e}evaluate(){st(this.debugLabel)}}class $n{constructor(e){this.target=e}evaluate(){let e=it();this.target.didModify(e)}}Sn.add(ke.Text,((e,{op1:t})=>{e.elements().appendText(e[At].getValue(t))})),Sn.add(ke.Comment,((e,{op1:t})=>{e.elements().appendComment(e[At].getValue(t))})),Sn.add(ke.OpenElement,((e,{op1:t})=>{e.elements().openElement(e[At].getValue(t))})),Sn.add(ke.OpenDynamicElement,(e=>{let t=i(_(i(e.stack.pop(),Qn)),d);e.elements().openElement(t)})),Sn.add(ke.PushRemoteElement,(e=>{let t=i(e.stack.pop(),Qn),n=i(e.stack.pop(),Qn),s=i(e.stack.pop(),Qn),r=i(_(t),p),a=i(_(n),h(o(m))),l=_(s);L(t)||e.updateWith(new Dn(t)),void 0===a||L(n)||e.updateWith(new Dn(n));let c=e.elements().pushRemoteElement(r,l,a);if(c&&e.associateDestroyable(c),void 0!==e.env.debugRenderTree){let s=Es(void 0===a?{}:{insertBefore:n},[t]);e.env.debugRenderTree.create(c,{type:"keyword",name:"in-element",args:s,instance:null}),De(c,(()=>{e.env.debugRenderTree?.willDestroy(c)}))}})),Sn.add(ke.PopRemoteElement,(e=>{let t=e.elements().popRemoteElement();void 0!==e.env.debugRenderTree&&e.env.debugRenderTree.didRender(t,t)})),Sn.add(ke.FlushElement,(e=>{let t=i(e.fetchValue(Ce),Xn),n=null;t&&(n=t.flush(e),e.loadValue(Ce,null)),e.elements().flushElement(n)})),Sn.add(ke.CloseElement,(e=>{let t=e.elements().closeElement();null!==t&&t.forEach((t=>{e.env.scheduleInstallModifier(t);const n=t.manager.getDestroyable(t.state);null!==n&&e.associateDestroyable(n)}))})),Sn.add(ke.Modifier,((e,{op1:t})=>{if(!1===e.env.isInteractive)return;let n=e.getOwner(),s=i(e.stack.pop(),es),r=e[At].getValue(t),{manager:a}=r,{constructing:o}=e.elements(),l=s.capture(),c=a.create(n,z(o,"BUG: ElementModifier could not find the element it applies to"),r.state,l),u={manager:a,state:c,definition:r};z(i(e.fetchValue(Ce),Xn),"BUG: ElementModifier could not find operations to append to").addModifier(e,u,l);let d=a.getTag(c);return null!==d?(lt(d),e.updateWith(new Hn(d,u))):void 0})),Sn.add(ke.DynamicModifier,(e=>{if(!1===e.env.isInteractive)return;let{stack:t}=e,n=i(t.pop(),Qn),s=i(t.pop(),es).capture(),{positional:r,named:a}=s,{constructing:o}=e.elements(),l=e.getOwner(),c=A((()=>{let e,t,i=_(n);if(!Q(i))return;if(An(i,xe.Modifier)){let{definition:n,owner:o,positional:l,named:c}=Mn(i);t=n,e=o,void 0!==l&&(s.positional=l.concat(r)),void 0!==c&&(s.named=Object.assign({},...c,a))}else t=i,e=l;let c=Ye(t,!0);if(null===c)throw new Error(`Expected a dynamic modifier definition, but received an object or function that did not have a modifier manager associated with it. The dynamic invocation was \`{{${n.debugLabel}}}\`, and the incorrect definition is the value at the path \`${n.debugLabel}\`, which was: ${ne(t)}`);let u={resolvedName:null,manager:c,state:t},d=c.create(e,z(o,"BUG: ElementModifier could not find the element it applies to"),u.state,s);return{manager:c,state:d,definition:u}})),u=_(c),d=null;if(void 0!==u){z(i(e.fetchValue(Ce),Xn),"BUG: ElementModifier could not find operations to append to").addModifier(e,u,s),d=u.manager.getTag(u.state),null!==d&&lt(d)}return!L(n)||d?e.updateWith(new jn(d,u,c)):void 0}));class Hn{lastUpdated;constructor(e,t){this.tag=e,this.modifier=t,this.lastUpdated=ct(e)}evaluate(e){let{modifier:t,tag:n,lastUpdated:s}=this;lt(n),ot(n,s)||(e.env.scheduleUpdateModifier(t),this.lastUpdated=ct(n))}}class jn{lastUpdated;constructor(e,t,n){this.tag=e,this.instance=t,this.instanceRef=n,this.lastUpdated=ct(e??ut)}evaluate(e){let{tag:t,lastUpdated:n,instance:s,instanceRef:i}=this,r=_(i);if(r!==s){if(void 0!==s){let e=s.manager.getDestroyable(s.state);null!==e&&Ve(e)}if(void 0!==r){let{manager:n,state:s}=r,i=n.getDestroyable(s);null!==i&&Ue(this,i),t=n.getTag(s),null!==t&&(this.lastUpdated=ct(t)),this.tag=t,e.env.scheduleInstallModifier(r)}this.instance=r}else null===t||ot(t,n)||(e.env.scheduleUpdateModifier(s),this.lastUpdated=ct(t));null!==t&&lt(t)}}Sn.add(ke.StaticAttr,((e,{op1:t,op2:n,op3:s})=>{let i=e[At].getValue(t),r=e[At].getValue(n),a=s?e[At].getValue(s):null;e.elements().setStaticAttribute(i,r,a)})),Sn.add(ke.DynamicAttr,((e,{op1:t,op2:n,op3:s})=>{let r=e[At].getValue(t),a=e[At].getValue(n),o=i(e.stack.pop(),Qn),l=_(o),c=s?e[At].getValue(s):null,u=e.elements().setDynamicAttribute(r,l,a,c);L(o)||e.updateWith(new Gn(o,u,e.env))}));class Gn{updateRef;constructor(e,t,n){let s=!1;this.updateRef=A((()=>{let i=_(e);!0===s?t.update(i,n):s=!0})),_(this.updateRef)}evaluate(){_(this.updateRef)}}Sn.add(ke.PushComponentDefinition,((e,{op1:t})=>{let n=e[At].getValue(t);K(!!n,`Missing component for ${t}`);let{manager:s,capabilities:i}=n,r={definition:n,manager:s,capabilities:i,state:null,handle:null,table:null,lookup:null};e.stack.push(r)})),Sn.add(ke.ResolveDynamicComponent,((e,{op1:t})=>{let n,s=e.stack,r=i(_(i(s.pop(),Qn)),f(d,ls)),a=e[At],o=e.getOwner(),l=a.getValue(t);if(e.loadValue(Te,null),"string"==typeof r){if(l)throw new Error(`Attempted to resolve a dynamic component with a string definition, \`${r}\` in a strict mode template. In strict mode, using strings to resolve component definitions is prohibited. You can instead import the component definition and use it directly.`);let t=function(e,t,n,s){let i=e.lookupComponent(n,z(s,"BUG: expected owner when looking up component"));if(!i)throw new Error(`Attempted to resolve \`${n}\`, which was expected to be a component, but nothing was found.`);return t.resolvedComponent(i,n)}(e.runtime.resolver,a,r,o);n=z(t,`Could not find a component named "${r}"`)}else n=_n(r)?r:a.component(r,o);s.push(n)})),Sn.add(ke.ResolveCurriedComponent,(e=>{let t,n=e.stack,s=i(n.pop(),Qn),r=_(s),a=e[At];if("function"!=typeof r&&("object"!=typeof r||null===r))throw new Error(`Expected a component definition, but received ${r}. You may have accidentally done <${s.debugLabel}>, where "${s.debugLabel}" was a string instead of a curried component definition. You must either use the component definition directly, or use the {{component}} helper to create a curried component definition when invoking dynamically.`);if(_n(r))t=r;else if(t=a.component(r,e.getOwner(),!0),null===t)throw new Error(`Expected a dynamic component definition, but received an object or function that did not have a component manager associated with it. The dynamic invocation was \`<${s.debugLabel}>\` or \`{{${s.debugLabel}}}\`, and the incorrect definition is the value at the path \`${s.debugLabel}\`, which was: ${ne(r)}`);n.push(t)})),Sn.add(ke.PushDynamicComponentInstance,(e=>{let t,n,{stack:s}=e,i=s.pop();_n(i)?n=t=null:(n=i.manager,t=i.capabilities),s.push({definition:i,capabilities:t,manager:n,state:null,handle:null,table:null})})),Sn.add(ke.PushArgs,((e,{op1:t,op2:n,op3:s})=>{let i=e.stack,r=e[At].getArray(t),a=s>>4,o=8&s,l=7&s?e[At].getArray(n):se;e[Rt].setup(i,r,l,a,!!o),i.push(e[Rt])})),Sn.add(ke.PushEmptyArgs,(e=>{let{stack:t}=e;t.push(e[Rt].empty(t))})),Sn.add(ke.CaptureArgs,(e=>{let t=e.stack,n=i(t.pop(),u(fs)).capture();t.push(n)})),Sn.add(ke.PrepareArgs,((e,{op1:t})=>{let n=e.stack,s=e.fetchValue(t),r=i(n.pop(),u(fs)),{definition:a}=s;if(An(a,xe.Component)){K(!a.manager,"If the component definition was curried, we don't yet have a manager");let t=e[At],{definition:n,owner:i,resolved:o,positional:l,named:c}=Mn(a);if(!0===o)a=n;else if("string"==typeof n){let s=e.runtime.resolver.lookupComponent(n,i);a=t.resolvedComponent(z(s,"BUG: expected resolved component"),n)}else a=t.component(n,i);void 0!==c&&r.named.merge(F({},...c)),void 0!==l&&(r.realloc(l.length),r.positional.prepend(l));let{manager:u}=a;K(null===s.manager,"component instance manager should not be populated yet"),K(null===s.capabilities,"component instance manager should not be populated yet"),s.definition=a,s.manager=u,s.capabilities=a.capabilities,e.loadValue(Te,i)}let{manager:o,state:l}=a,c=s.capabilities;if(!Je(o,c,Ne.prepareArgs))return void n.push(r);let d=r.blocks.values,p=r.blocks.names,h=o.prepareArgs(l,r);if(h){r.clear();for(let e=0;e<d.length;e++)n.push(d[e]);let{positional:e,named:t}=h,s=e.length;for(let t=0;t<s;t++)n.push(e[t]);let i=Object.keys(t);for(let e=0;e<i.length;e++)n.push(t[W(i[e])]);r.setup(n,i,p,s,!1)}n.push(r)})),Sn.add(ke.CreateComponent,((e,{op1:t,op2:n})=>{let s=i(e.fetchValue(n),os),{definition:r,manager:a,capabilities:o}=s;if(!Je(a,o,Ne.createInstance))return;let l=null;Je(a,o,Ne.dynamicScope)&&(l=e.dynamicScope());let c=1&t,u=null;Je(a,o,Ne.createArgs)&&(u=i(e.stack.peek(),es));let d=null;Je(a,o,Ne.createCaller)&&(d=e.getSelf());let p=a.create(e.getOwner(),r.state,u,e.env,l,d,!!c);s.state=p,Je(a,o,Ne.updateHook)&&e.updateWith(new Yn(p,a,l))})),Sn.add(ke.RegisterComponentDestructor,((e,{op1:t})=>{let{manager:n,state:s,capabilities:r}=i(e.fetchValue(t),os),a=n.getDestroyable(s);if(!Je(n,r,Ne.willDestroy)&&null!==a&&"string"in a)throw new Error("BUG: Destructor has willDestroy, but the willDestroy capability was not enabled for this component. Pre-destruction hooks must be explicitly opted into");a&&e.associateDestroyable(a)})),Sn.add(ke.BeginComponentTransaction,((e,{op1:t})=>{let n;{let{definition:s,manager:r}=i(e.fetchValue(t),os);n=s.resolvedName??r.getDebugName(s.state)}e.beginCacheGroup(n),e.elements().pushSimpleBlock()})),Sn.add(ke.PutComponentOperations,(e=>{e.loadValue(Ce,new Pn)})),Sn.add(ke.ComponentAttr,((e,{op1:t,op2:n,op3:s})=>{let r=e[At].getValue(t),a=e[At].getValue(n),o=i(e.stack.pop(),Qn),l=s?e[At].getValue(s):null;i(e.fetchValue(Ce),u(Pn)).setAttribute(r,o,a,l)})),Sn.add(ke.StaticComponentAttr,((e,{op1:t,op2:n,op3:s})=>{let r=e[At].getValue(t),a=e[At].getValue(n),o=s?e[At].getValue(s):null;i(e.fetchValue(Ce),u(Pn)).setStaticAttribute(r,a,o)}));class Pn{attributes=ie();classes=[];modifiers=[];setAttribute(e,t,n,s){let i={value:t,namespace:s,trusting:n};"class"===e&&this.classes.push(t),this.attributes[e]=i}setStaticAttribute(e,t,n){let s={value:t,namespace:n};"class"===e&&this.classes.push(t),this.attributes[e]=s}addModifier(e,t,n){if(this.modifiers.push(t),void 0!==e.env.debugRenderTree){const{manager:s,definition:i,state:r}=t;if(null===r||"object"!=typeof r&&"function"!=typeof r)return;let{element:a,constructing:o}=e.elements(),l=s.getDebugName(i.state),c=s.getDebugInstance(r);K(o,"Expected a constructing element in addModifier");let u=new Lt(a,o,o);e.env.debugRenderTree.create(r,{type:"modifier",name:l,args:n,instance:c}),e.env.debugRenderTree.didRender(r,u),e.associateDestroyable(r),e.updateWith(new qn(r)),e.updateWith(new Kn(r,u)),De(r,(()=>{e.env.debugRenderTree?.willDestroy(r)}))}}flush(e){let t,n=this.attributes;for(let s in this.attributes){if("type"===s){t=n[s];continue}let i=W(this.attributes[s]);"class"===s?Wn(e,"class",Fn(this.classes),i.namespace,i.trusting):Wn(e,s,i.value,i.namespace,i.trusting)}return void 0!==t&&Wn(e,"type",t.value,t.namespace,t.trusting),this.modifiers}}function Fn(e){return 0===e.length?"":1===e.length?W(e[0]):function(e){return e.every((e=>"string"==typeof e))}(e)?e.join(" "):(t=e,A((()=>{let e=[];for(const n of t){let t=Vt("string"==typeof n?n:_(n));t&&e.push(t)}return 0===e.length?null:e.join(" ")})));var t}function Wn(e,t,n,s,i=!1){if("string"==typeof n)e.elements().setStaticAttribute(t,n,s);else{let r=e.elements().setDynamicAttribute(t,_(n),i,s);L(n)||e.updateWith(new Gn(n,r,e.env))}}function zn(e,t,n,s,i){let r=n.table.symbols.indexOf(e),a=s.get(t);-1!==r&&i.scope().bindBlock(r+1,a),n.lookup&&(n.lookup[e]=a)}Sn.add(ke.DidCreateElement,((e,{op1:t})=>{let{definition:n,state:s}=i(e.fetchValue(t),os),{manager:r}=n,a=i(e.fetchValue(Ce),u(Pn));r.didCreateElement(s,z(e.elements().constructing,"Expected a constructing element in DidCreateOpcode"),a)})),Sn.add(ke.GetComponentSelf,((e,{op1:t,op2:n})=>{let s=i(e.fetchValue(t),os),{definition:r,state:a}=s,{manager:o}=r,l=o.getSelf(a);if(void 0!==e.env.debugRenderTree){let s,r,o=i(e.fetchValue(t),os),{definition:c,manager:u}=o;if(e.stack.peek()===e[Rt])s=e[Rt].capture();else{let t=e[At].getArray(n);e[Rt].setup(e.stack,t,[],0,!0),s=e[Rt].capture()}let d=c.compilable;if(null===d?(K(Je(u,o.capabilities,Ne.dynamicLayout),"BUG: No template was found for this component, and the component did not have the dynamic layout capability"),d=u.getDynamicLayout(a,e.runtime.resolver),r=null!==d?d.moduleName:"__default__.hbs"):r=d.moduleName,e.associateDestroyable(o),On(u)){u.getDebugCustomRenderTree(o.definition.state,o.state,s,r).forEach((t=>{let{bucket:n}=t;e.env.debugRenderTree.create(n,t),De(o,(()=>{e.env.debugRenderTree?.willDestroy(n)})),e.updateWith(new qn(n))}))}else{let t=c.resolvedName??u.getDebugName(c.state);e.env.debugRenderTree.create(o,{type:"component",name:t,args:s,template:r,instance:_(l)}),De(o,(()=>{e.env.debugRenderTree?.willDestroy(o)})),e.updateWith(new qn(o))}}e.stack.push(l)})),Sn.add(ke.GetComponentTagName,((e,{op1:t})=>{let{definition:n,state:s}=i(e.fetchValue(t),os),{manager:r}=n,a=r.getTagName(s);e.stack.push(a)})),Sn.add(ke.GetComponentLayout,((e,{op1:t})=>{let n=i(e.fetchValue(t),os),{manager:s,definition:r}=n,{stack:a}=e,{compilable:o}=r;if(null===o){let{capabilities:t}=n;K(Je(s,t,Ne.dynamicLayout),"BUG: No template was found for this component, and the component did not have the dynamic layout capability"),o=s.getDynamicLayout(n.state,e.runtime.resolver),null===o&&(o=Je(s,t,Ne.wrapped)?re(e[At].defaultTemplate).asWrappedLayout():re(e[At].defaultTemplate).asLayout())}let l=o.compile(e.context);a.push(o.symbolTable),a.push(l)})),Sn.add(ke.Main,((e,{op1:t})=>{let n=i(e.stack.pop(),ms),s=i(e.stack.pop(),cs),{manager:r,capabilities:a}=n,o={definition:n,manager:r,capabilities:a,state:null,handle:s.handle,table:s.symbolTable,lookup:null};e.loadValue(t,o)})),Sn.add(ke.PopulateLayout,((e,{op1:t})=>{let{stack:n}=e,s=i(n.pop(),l),r=i(n.pop(),g),a=i(e.fetchValue(t),os);a.handle=s,a.table=r})),Sn.add(ke.VirtualRootScope,((e,{op1:t})=>{let n,{table:s,manager:r,capabilities:a,state:o}=i(e.fetchValue(t),us);Je(r,a,Ne.hasSubOwner)?(n=r.getOwner(o),e.loadValue(Te,null)):(n=e.fetchValue(Te),null===n?n=e.getOwner():e.loadValue(Te,null)),e.pushRootScope(s.symbols.length+1,n)})),Sn.add(ke.SetupForEval,((e,{op1:t})=>{let n=i(e.fetchValue(t),us);if(n.table.hasEval){let t=n.lookup=ie();e.scope().bindEvalScope(t)}})),Sn.add(ke.SetNamedVariables,((e,{op1:t})=>{let n=i(e.fetchValue(t),us),s=e.scope(),r=i(e.stack.peek(),es),a=r.named.atNames;for(let e=a.length-1;e>=0;e--){let t=W(a[e]),i=n.table.symbols.indexOf(t),o=r.named.get(t,!0);-1!==i&&s.bindSymbol(i+1,o),n.lookup&&(n.lookup[t]=o)}})),Sn.add(ke.SetBlocks,((e,{op1:t})=>{let n=i(e.fetchValue(t),us),{blocks:s}=i(e.stack.peek(),es);for(const[t]of ae(s.names))zn(W(s.symbolNames[t]),W(s.names[t]),n,s,e)})),Sn.add(ke.InvokeComponentLayout,((e,{op1:t})=>{let n=i(e.fetchValue(t),us);e.call(n.handle)})),Sn.add(ke.DidRenderLayout,((e,{op1:t})=>{let n=i(e.fetchValue(t),os),{manager:s,state:r,capabilities:a}=n,o=e.elements().popBlock();if(void 0!==e.env.debugRenderTree)if(On(s)){s.getDebugCustomRenderTree(n.definition.state,r,Ls).reverse().forEach((t=>{let{bucket:n}=t;e.env.debugRenderTree.didRender(n,o),e.updateWith(new Kn(n,o))}))}else e.env.debugRenderTree.didRender(n,o),e.updateWith(new Kn(n,o));if(Je(s,a,Ne.createInstance)){i(s,b({didRenderLayout:y})).didRenderLayout(r,o),e.env.didCreate(n),e.updateWith(new Jn(n,o))}})),Sn.add(ke.CommitComponentTransaction,(e=>{e.commitCacheGroup()}));class Yn{constructor(e,t,n){this.component=e,this.manager=t,this.dynamicScope=n}evaluate(e){let{component:t,manager:n,dynamicScope:s}=this;n.update(t,s)}}class Jn{constructor(e,t){this.component=e,this.bounds=t}evaluate(e){let{component:t,bounds:n}=this,{manager:s,state:i}=t;s.didUpdateLayout(i,n),e.env.didUpdate(t)}}class qn{constructor(e){this.bucket=e}evaluate(e){e.env.debugRenderTree?.update(this.bucket)}}class Kn{constructor(e,t){this.bucket=e,this.bounds=t}evaluate(e){e.env.debugRenderTree?.didRender(this.bucket,this.bounds)}}b({[dt]:y});const Xn=k((()=>o(u(Pn))));const Qn=new class{validate(e){return"object"==typeof e&&null!==e&&U in e}expected(){return"Reference"}},Zn=b({next:y,isEmpty:y}),es=k((()=>u(fs))),ts=y;const ns=new class{validate(e){return e===B}expected(){return"undefined"}},ss=b({positional:k((()=>v(Qn))),named:k((()=>w(Qn)))}),is=k((()=>u(xt))),rs=b({getCapabilities:y}),as=a,os=b({definition:S,state:S,handle:S,table:S}),ls=f(E,y),cs=b({handle:a,symbolTable:g});b({setAttribute:y});const us=b({definition:S,state:S,handle:l,table:g}),ds=b({compile:y,symbolTable:c}),ps=b({compile:y,symbolTable:g}),hs=b({0:ds,1:is,2:c}),ms=b({resolvedName:o(d),handle:a,state:f(E,y),manager:rs,capabilities:as,compilable:ps});class fs{stack=null;positional=new bs;named=new ys;blocks=new ws;empty(e){let t=e[Bt][we]+1;return this.named.empty(e,t),this.positional.empty(e,t),this.blocks.empty(e,t),this}setup(e,t,n,s,i){this.stack=e;let r=this.named,a=t.length,o=e[Bt][we]-a+1;r.setup(e,o,a,t,i);let l=o-s;this.positional.setup(e,l,s);let c=this.blocks,u=n.length,d=l-3*u;c.setup(e,d,u,n)}get base(){return this.blocks.base}get length(){return this.positional.length+this.named.length+3*this.blocks.length}at(e){return this.positional.at(e)}realloc(e){let{stack:t}=this;if(e>0&&null!==t){let{positional:n,named:s}=this,i=n.base+e;for(let e=n.length+s.length-1;e>=0;e--)t.copy(e+n.base,e+i);n.base+=e,s.base+=e,t[Bt][we]+=e}}capture(){let e=0===this.positional.length?Ms:this.positional.capture();return{named:0===this.named.length?Rs:this.named.capture(),positional:e}}clear(){let{stack:e,length:t}=this;t>0&&null!==e&&e.pop(t)}}const gs=oe();class bs{base=0;length=0;stack=null;_references=null;empty(e,t){this.stack=e,this.base=t,this.length=0,this._references=gs}setup(e,t,n){this.stack=e,this.base=t,this.length=n,this._references=0===n?gs:null}at(e){let{base:t,length:n,stack:s}=this;return e<0||e>=n?B:i(s.get(e,t),Qn)}capture(){return this.references}prepend(e){let t=e.length;if(t>0){let{base:n,length:s,stack:i}=this;this.base=n-=t,this.length=s+t;for(let s=0;s<t;s++)i.set(e[s],s,n);this._references=null}}get references(){let e=this._references;if(!e){let{stack:t,base:n,length:s}=this;e=this._references=t.slice(n,n+s)}return e}}class ys{base=0;length=0;_references=null;_names=se;_atNames=se;empty(e,t){this.stack=e,this.base=t,this.length=0,this._references=gs,this._names=se,this._atNames=se}setup(e,t,n,s,i){this.stack=e,this.base=t,this.length=n,0===n?(this._references=gs,this._names=se,this._atNames=se):(this._references=null,i?(this._names=null,this._atNames=s):(this._names=s,this._atNames=null))}get names(){let e=this._names;return e||(e=this._names=this._atNames.map(this.toSyntheticName)),e}get atNames(){let e=this._atNames;return e||(e=this._atNames=this._names.map(this.toAtName)),e}has(e){return-1!==this.names.indexOf(e)}get(e,t=!1){let{base:n,stack:s}=this,i=(t?this.atNames:this.names).indexOf(e);if(-1===i)return B;let r=s.get(i,n);return I(t?e:`@${e}`,r)}capture(){let{names:e,references:t}=this,n=ie();for(const[s,i]of ae(e))n[i]=I(`@${i}`,W(t[s]));return n}merge(e){let t=Object.keys(e);if(t.length>0){let{names:n,length:s,stack:i}=this,r=n.slice();for(const n of t){-1===r.indexOf(n)&&(s=r.push(n),i.push(e[n]))}this.length=s,this._references=null,this._names=r,this._atNames=null}}get references(){let e=this._references;if(!e){let{base:t,length:n,stack:s}=this;e=this._references=s.slice(t,t+n)}return e}toSyntheticName(e){return e.slice(1)}toAtName(e){return`@${e}`}}function ks(e){return`&${e}`}const vs=oe();class ws{internalValues=null;_symbolNames=null;internalTag=null;names=se;length=0;base=0;empty(e,t){this.stack=e,this.names=se,this.base=t,this.length=0,this._symbolNames=null,this.internalTag=rt,this.internalValues=vs}setup(e,t,n,s){this.stack=e,this.names=s,this.base=t,this.length=n,this._symbolNames=null,0===n?(this.internalTag=rt,this.internalValues=vs):(this.internalTag=null,this.internalValues=null)}get values(){let e=this.internalValues;if(!e){let{base:t,length:n,stack:s}=this;e=this.internalValues=s.slice(t,t+3*n)}return e}has(e){return-1!==this.names.indexOf(e)}get(e){let t=this.names.indexOf(e);if(-1===t)return null;let{base:n,stack:s}=this,r=i(s.get(3*t,n),o(c)),a=i(s.get(3*t+1,n),o(is)),u=i(s.get(3*t+2,n),o(f(l,ds)));return null===u?null:[u,a,r]}capture(){return new Ss(this.names,this.values)}get symbolNames(){let e=this._symbolNames;return null===e&&(e=this._symbolNames=this.names.map(ks)),e}}class Ss{length;constructor(e,t){this.names=e,this.values=t,this.length=e.length}has(e){return-1!==this.names.indexOf(e)}get(e){let t=this.names.indexOf(e);return-1===t?null:[this.values[3*t+2],this.values[3*t+1],this.values[3*t]]}}function Es(e,t){return{named:e,positional:t}}function xs(e){let t=ie();for(const[n,s]of Object.entries(e))t[n]=_(s);return t}function Cs(e){return e.map(_)}function Ts(e){return{named:xs(e.named),positional:Cs(e.positional)}}const Ns=Symbol("ARGUMENT_ERROR");function Bs(e){return null!==e&&"object"==typeof e&&e[Ns]}function _s(e){return{[Ns]:!0,error:e}}function As(e){return{named:function(e){let t=ie();for(const[n,s]of Object.entries(e))try{t[n]=_(s)}catch(e){t[n]=_s(e)}return t}(e.named),positional:function(e){return e.map((e=>{try{return _(e)}catch(e){return _s(e)}}))}(e.positional)}}const Rs=Object.freeze(Object.create(null)),Ms=gs,Ls=Es(Rs,Ms);function Os(e){return"string"==typeof e?e:"function"!=typeof e.toString?"":String(e)}function Ds(e,t){let n,s=qe(e,!0);if(null===s?n=null:(n="function"==typeof s?s:s.getHelper(e),K(s,"BUG: expected manager or helper")),null===n)throw new Error(`Expected a dynamic helper definition, but received an object or function that did not have a helper manager associated with it. The dynamic invocation was \`{{${t.debugLabel}}}\` or \`(${t.debugLabel})\`, and the incorrect definition is the value at the path \`${t.debugLabel}\`, which was: ${ne(e)}`);return n}function Vs(e){return K(Array.isArray(e)||e===B,"a reference other than UNDEFINED_REFERENCE is illegal here"),e===B}Sn.add(ke.Curry,((e,{op1:t,op2:n})=>{let s=e.stack,r=i(s.pop(),Qn),a=i(s.pop(),ss),o=e.getOwner(),l=e.runtime.resolver,c=!1;c=e[At].getValue(Z(n)),e.loadValue(Be,function(e,t,n,s,i,r){let a,o;return A((()=>{let l=_(t);if(l===a)return o;if(An(l,e))o=s?Ln(e,l,n,s):s;else if(e===xe.Component&&"string"==typeof l&&l){if(r)throw new Error(`Attempted to resolve a dynamic component with a string definition, \`${l}\` in a strict mode template. In strict mode, using strings to resolve component definitions is prohibited. You can instead import the component definition and use it directly.`);if(!z(i,"BUG: expected resolver for curried component definitions").lookupComponent(l,n))throw new Error(`Attempted to resolve \`${l}\`, which was expected to be a component, but nothing was found.`);o=Ln(e,l,n,s)}else o=Q(l)?Ln(e,l,n,s):null;return a=l,o}))}(t,r,o,a,l,c))})),Sn.add(ke.DynamicHelper,(e=>{let t,n=e.stack,s=i(n.pop(),Qn),r=i(n.pop(),es).capture(),a=e.getOwner(),o=A((()=>{void 0!==t&&Ve(t);let e=_(s);if(An(e,xe.Helper)){let{definition:n,owner:i,positional:a,named:l}=Mn(e),c=Ds(n,s);void 0!==l&&(r.named=F({},...l,r.named)),void 0!==a&&(r.positional=a.concat(r.positional)),t=c(r,i),Ue(o,t)}else if(Q(e)){let n=Ds(e,s);t=n(r,a),Ie(t)&&Ue(o,t)}else t=B})),l=A((()=>(_(o),_(t))));e.associateDestroyable(o),e.loadValue(Be,l)})),Sn.add(ke.Helper,((e,{op1:t})=>{let n=e.stack,s=i(e[At].getValue(t),ts)(i(n.pop(),es).capture(),e.getOwner(),e.dynamicScope());Ie(s)&&e.associateDestroyable(s),e.loadValue(Be,s)})),Sn.add(ke.GetVariable,((e,{op1:t})=>{let n=e.referenceForSymbol(t);e.stack.push(n)})),Sn.add(ke.SetVariable,((e,{op1:t})=>{let n=i(e.stack.pop(),Qn);e.scope().bindSymbol(t,n)})),Sn.add(ke.SetBlock,((e,{op1:t})=>{let n=i(e.stack.pop(),ds),s=i(e.stack.pop(),is),r=i(e.stack.pop(),c);e.scope().bindBlock(t,[n,s,r])})),Sn.add(ke.ResolveMaybeLocal,((e,{op1:t})=>{let n=e[At].getValue(t),s=e.scope().getPartialMap()[n];void 0===s&&(s=$(e.getSelf(),n)),e.stack.push(s)})),Sn.add(ke.RootScope,((e,{op1:t})=>{e.pushRootScope(t,e.getOwner())})),Sn.add(ke.GetProperty,((e,{op1:t})=>{let n=e[At].getValue(t),s=i(e.stack.pop(),Qn);e.stack.push($(s,n))})),Sn.add(ke.GetBlock,((e,{op1:t})=>{let{stack:n}=e,s=e.scope().getBlock(t);n.push(s)})),Sn.add(ke.SpreadBlock,(e=>{let{stack:t}=e,n=i(t.pop(),o(f(hs,ns)));if(n&&!Vs(n)){let[e,s,i]=n;t.push(i),t.push(s),t.push(e)}else t.push(null),t.push(null),t.push(null)})),Sn.add(ke.HasBlock,(e=>{let{stack:t}=e,n=i(t.pop(),o(f(hs,ns)));n&&!Vs(n)?t.push(D):t.push(V)})),Sn.add(ke.HasBlockParams,(e=>{let t=e.stack.pop(),n=e.stack.pop();i(t,h(f(l,ds))),i(n,h(is));let s=i(e.stack.pop(),h(c)),r=s&&s.parameters.length;e.stack.push(r?D:V)})),Sn.add(ke.Concat,((e,{op1:t})=>{let n=new Array(t);for(let s=t;s>0;s--){n[s-1]=i(e.stack.pop(),Qn)}var s;e.stack.push((s=n,A((()=>{const e=[];for(const t of s){const n=_(t);null!=n&&e.push(Os(n))}return e.length>0?e.join(""):null}))))})),Sn.add(ke.IfInline,(e=>{let t=i(e.stack.pop(),Qn),n=i(e.stack.pop(),Qn),s=i(e.stack.pop(),Qn);e.stack.push(A((()=>!0===Pe(_(t))?_(n):_(s))))})),Sn.add(ke.Not,(e=>{let t=i(e.stack.pop(),Qn);e.stack.push(A((()=>!Pe(_(t)))))})),Sn.add(ke.GetDynamicVar,(e=>{let t=e.dynamicScope(),n=e.stack,s=i(n.pop(),Qn);n.push(A((()=>{let e=String(_(s));return _(t.get(e))})))})),Sn.add(ke.Log,(e=>{let{positional:t}=i(e.stack.pop(),es).capture();e.loadValue(Be,A((()=>{console.log(...Cs(t))})))}));class Us{constructor(e,t,n){this.node=e,this.reference=t,this.lastValue=n}evaluate(){let e,t=_(this.reference),{lastValue:n}=this;if(t!==n&&(e=Ut(t)?"":Ht(t)?t:String(t),e!==n)){this.node.nodeValue=this.lastValue=e}}}function Is(e){return function(e){return Ht(e)||Ut(e)||"boolean"==typeof e||"number"==typeof e}(e)?_e.String:An(e,Ae.Component)||Ke(e)?_e.Component:An(e,Ae.Helper)||Xe(e)?_e.Helper:It(e)?_e.SafeString:function(e){return $t(e)&&11===e.nodeType}(e)?_e.Fragment:$t(e)?_e.Node:_e.String}function $s(e){if(!Q(e))return _e.String;if(An(e,Ae.Component)||Ke(e))return _e.Component;if(!An(e,Ae.Helper)&&!Xe(e))throw new Error(`Attempted use a dynamic value as a component or helper, but that value did not have an associated component or helper manager. The value was: ${e}`);return _e.Helper}function Hs(e,t){console.info("Use `context`, and `get(<path>)` to debug this template."),t("this")}Sn.add(ke.ContentType,(e=>{let t=i(e.stack.peek(),Qn);e.stack.push(Is(_(t))),L(t)||e.updateWith(new Vn(t,Is))})),Sn.add(ke.DynamicContentType,(e=>{let t=i(e.stack.peek(),Qn);e.stack.push($s(_(t))),L(t)||e.updateWith(new Vn(t,$s))})),Sn.add(ke.AppendHTML,(e=>{let t=i(e.stack.pop(),Qn),n=_(t),s=Ut(n)?"":String(n);e.elements().appendDynamicHTML(s)})),Sn.add(ke.AppendSafeHTML,(e=>{let t=i(e.stack.pop(),Qn),n=i(_(t),x).toHTML(),s=Ut(n)?"":i(n,d);e.elements().appendDynamicHTML(s)})),Sn.add(ke.AppendText,(e=>{let t=i(e.stack.pop(),Qn),n=_(t),s=Ut(n)?"":String(n),r=e.elements().appendDynamicText(s);L(t)||e.updateWith(new Us(r,t,s))})),Sn.add(ke.AppendDocumentFragment,(e=>{let t=i(e.stack.pop(),Qn),n=i(_(t),C);e.elements().appendDynamicFragment(n)})),Sn.add(ke.AppendNode,(e=>{let t=i(e.stack.pop(),Qn),n=i(_(t),m);e.elements().appendDynamicNode(n)}));let js=Hs;function Gs(e){js=e}function Ps(){js=Hs}class Fs{locals=ie();constructor(e,t,n){this.scope=e;for(const s of n){let n=W(t[s-1]),i=e.getSymbol(s);this.locals[n]=i}}get(e){let t,{scope:n,locals:s}=this,i=e.split("."),[r,...a]=e.split("."),o=n.getEvalScope();return"this"===r?t=n.getSelf():s[r]?t=W(s[r]):0===r.indexOf("@")&&o[r]?t=o[r]:(t=this.scope.getSelf(),a=i),a.reduce(((e,t)=>$(e,t)),t)}}Sn.add(ke.Debugger,((e,{op1:t,op2:n})=>{let s=e[At].getArray(t),i=e[At].getArray(Z(n)),r=new Fs(e.scope(),s,i);js(_(e.getSelf()),(e=>_(r.get(e))))})),Sn.add(ke.EnterList,((e,{op1:t,op2:n})=>{let s=e.stack,r=i(s.pop(),Qn),a=i(s.pop(),Qn),o=_(a),l=null===o?"@identity":String(o),c=H(r,l),u=_(c);e.updateWith(new Vn(c,(e=>e.isEmpty()))),!0===u.isEmpty()?e.goto(n+1):(e.enterList(c,t),e.stack.push(u))})),Sn.add(ke.ExitList,(e=>{e.exitList()})),Sn.add(ke.Iterate,((e,{op1:t})=>{let n=e.stack,s=i(n.peek(),Zn).next();null!==s?e.registerItem(e.enterItem(s)):e.goto(t)}));const Ws={dynamicLayout:!1,dynamicTag:!1,prepareArgs:!1,createArgs:!1,attributeHook:!1,elementHook:!1,createCaller:!1,dynamicScope:!1,updateHook:!1,createInstance:!1,wrapped:!1,willDestroy:!1,hasSubOwner:!1};class zs{getCapabilities(){return Ws}getDebugName({name:e}){return e}getSelf(){return O}getDestroyable(){return null}}const Ys=new zs;class Js{constructor(e="@glimmer/component/template-only",t="(unknown template-only component)"){this.moduleName=e,this.name=t}toString(){return this.moduleName}}function qs(e,t){return new Js(e,t)}Qe(Ys,Js.prototype);const Ks={foreignObject:1,desc:1,title:1},Xs=Object.create(null);class Qs{constructor(e){this.document=e,this.setupUselessElement()}setupUselessElement(){this.uselessElement=this.document.createElement("div")}createElement(e,t){let n,s;if(t?(n=t.namespaceURI===Y||"svg"===e,s=!!Ks[t.tagName]):(n="svg"===e,s=!1),n&&!s){if(Xs[e])throw new Error(`Cannot create a ${e} inside an SVG context`);return this.document.createElementNS(Y,e)}return this.document.createElement(e)}insertBefore(e,t,n){e.insertBefore(t,n)}insertHTMLBefore(e,t,n){if(""===n){const n=this.createComment("");return e.insertBefore(n,t),new Lt(e,n,n)}const s=t?t.previousSibling:e.lastChild;let i;if(null===t)e.insertAdjacentHTML(le,n),i=z(e.lastChild,"bug in insertAdjacentHTML?");else if(t instanceof HTMLElement)t.insertAdjacentHTML("beforebegin",n),i=z(t.previousSibling,"bug in insertAdjacentHTML?");else{const{uselessElement:s}=this;e.insertBefore(s,t),s.insertAdjacentHTML(ce,n),i=z(s.previousSibling,"bug in insertAdjacentHTML?"),e.removeChild(s)}const r=z(s?s.nextSibling:e.firstChild,"bug in insertAdjacentHTML?");return new Lt(e,r,i)}createTextNode(e){return this.document.createTextNode(e)}createComment(e){return this.document.createComment(e)}}function Zs(e,t,n){if(!e)return t;if(!function(e,t){const n=e.createElementNS(t,"svg");try{n.insertAdjacentHTML(le,"<circle></circle>")}catch(e){}finally{return 1!==n.childNodes.length||J(W(n.firstChild),"SVG").namespaceURI!==Y}}(e,n))return t;const s=e.createElement("div");return class extends t{insertHTMLBefore(e,t,i){return""===i||e.namespaceURI!==n?super.insertHTMLBefore(e,t,i):function(e,t,n,s){let i;if(K(""!==n,"html cannot be empty"),"FOREIGNOBJECT"===e.tagName.toUpperCase()){const e="<svg><foreignObject>"+n+"</foreignObject></svg>";ue(t),t.insertAdjacentHTML(de,e),i=t.firstChild.firstChild}else{const e="<svg>"+n+"</svg>";ue(t),t.insertAdjacentHTML(de,e),i=t.firstChild}return function(e,t,n){const s=z(e.firstChild,"source is empty");let i=s,r=s;for(;r;){const e=r.nextSibling;t.insertBefore(r,n),i=r,r=e}return new Lt(t,s,i)}(i,e,s)}(e,s,i,t)}}}function ei(e,t){return e&&function(e){const t=e.createElement("div");if(t.appendChild(e.createTextNode("first")),t.insertAdjacentHTML(le,"second"),2===t.childNodes.length)return!1;return!0}(e)?class extends t{uselessComment;constructor(e){super(e),this.uselessComment=e.createComment("")}insertHTMLBefore(e,t,n){if(""===n)return super.insertHTMLBefore(e,t,n);let s=!1;const i=t?t.previousSibling:e.lastChild;i&&i instanceof Text&&(s=!0,e.insertBefore(this.uselessComment,t));const r=super.insertHTMLBefore(e,t,n);return s&&e.removeChild(this.uselessComment),r}}:t}const ti="undefined"==typeof document?null:pe(document);let ni=class extends Qs{createElementNS(e,t){return this.document.createElementNS(e,t)}setAttribute(e,t,n,s=null){s?e.setAttributeNS(s,t,n):e.setAttribute(t,n)}};ni=ei(ti,ni),ni=Zs(ti,ni,Y);const si=ni;["b","big","blockquote","body","br","center","code","dd","div","dl","dt","em","embed","h1","h2","h3","h4","h5","h6","head","hr","i","img","li","listing","main","meta","nobr","ol","p","pre","ruby","s","small","span","strong","strike","sub","sup","table","tt","u","ul","var"].forEach((e=>Xs[e]=1));const ii=/[\t\n\v\f\r \xA0\u{1680}\u{180e}\u{2000}-\u{200a}\u{2028}\u{2029}\u{202f}\u{205f}\u{3000}\u{feff}]/u,ri="undefined"==typeof document?null:pe(document);function ai(e){return ii.test(e)}class oi extends Qs{namespace;constructor(e){super(e),this.document=e,this.namespace=null}setAttribute(e,t,n){e.setAttribute(t,n)}removeAttribute(e,t){e.removeAttribute(t)}insertAfter(e,t,n){this.insertBefore(e,t,n.nextSibling)}}let li=oi;li=ei(ri,li),li=Zs(ri,li,Y);const ci=li;let ui=0;class di{id=ui++;value;constructor(e){this.value=e}get(){return this.value}release(){if(null===this.value)throw new Error("BUG: double release?");this.value=null}toString(){let e=`Ref ${this.id}`;if(null===this.value)return`${e} (released)`;try{return`${e}: ${this.value}`}catch{return e}}}class pi{stack=new q;refs=new WeakMap;roots=new Set;nodes=new WeakMap;begin(){this.reset()}create(e,t){let n=F({},t,{bounds:null,refs:new Set});this.nodes.set(e,n),this.appendChild(n,e),this.enter(e)}update(e){this.enter(e)}didRender(e,t){if(this.stack.current!==e)throw new Error(`BUG: expecting ${this.stack.current}, got ${e}`);this.nodeFor(e).bounds=t,this.exit()}willDestroy(e){z(this.refs.get(e),"BUG: missing ref").release()}commit(){this.reset()}capture(){return this.captureRefs(this.roots)}reset(){if(0!==this.stack.size){let e=z(this.stack.toArray()[0],"expected root state when resetting render tree"),t=this.refs.get(e);for(void 0!==t&&this.roots.delete(t);!this.stack.isEmpty();)this.stack.pop()}}enter(e){this.stack.push(e)}exit(){if(0===this.stack.size)throw new Error("BUG: unbalanced pop");this.stack.pop()}nodeFor(e){return z(this.nodes.get(e),"BUG: missing node")}appendChild(e,t){if(this.refs.has(t))throw new Error("BUG: child already appended");let n=this.stack.current,s=new di(t);if(this.refs.set(t,s),n){let t=this.nodeFor(n);t.refs.add(s),e.parent=t}else this.roots.add(s)}captureRefs(e){let t=[];return e.forEach((n=>{let s=n.get();s?t.push(this.captureNode(`render-node:${n.id}`,s)):e.delete(n)})),t}captureNode(e,t){let n=this.nodeFor(t),{type:s,name:i,args:r,instance:a,refs:o}=n,l=this.captureTemplate(n),c=this.captureBounds(n),u=this.captureRefs(o);return{id:e,type:s,name:i,args:As(r),instance:a,template:l,bounds:c,children:u}}captureTemplate({template:e}){return e||null}captureBounds(e){let t=z(e.bounds,"BUG: missing bounds");return{parentElement:t.parentElement(),firstNode:t.firstNode(),lastNode:t.lastNode()}}}const hi=Symbol("TRANSACTION");class mi{scheduledInstallModifiers=[];scheduledUpdateModifiers=[];createdComponents=[];updatedComponents=[];didCreate(e){this.createdComponents.push(e)}didUpdate(e){this.updatedComponents.push(e)}scheduleInstallModifier(e){this.scheduledInstallModifiers.push(e)}scheduleUpdateModifier(e){this.scheduledUpdateModifiers.push(e)}commit(){let{createdComponents:e,updatedComponents:t}=this;for(const{manager:t,state:n}of e)t.didCreate(n);for(const{manager:e,state:n}of t)e.didUpdate(n);let{scheduledInstallModifiers:n,scheduledUpdateModifiers:s}=this;for(const{manager:e,state:t,definition:s}of n){let n=e.getTag(t);if(null!==n){let i=pt((()=>e.install(t)),`- While rendering:\n  (instance of a \`${s.resolvedName||e.getDebugName(s.state)}\` modifier)`);ht(n,i)}else e.install(t)}for(const{manager:e,state:t,definition:n}of s){let s=e.getTag(t);if(null!==s){let i=pt((()=>e.update(t)),`- While rendering:\n  (instance of a \`${n.resolvedName||e.getDebugName(n.state)}\` modifier)`);ht(s,i)}else e.update(t)}}}class fi{[hi]=null;updateOperations;isInteractive;isArgumentCaptureError;debugRenderTree;constructor(e,t){if(this.delegate=t,this.isInteractive=t.isInteractive,this.debugRenderTree=this.delegate.enableDebugTooling?new pi:void 0,this.isArgumentCaptureError=this.delegate.enableDebugTooling?Bs:void 0,e.appendOperations)this.appendOperations=e.appendOperations,this.updateOperations=e.updateOperations;else{if(!e.document)throw new Error("you must pass document or appendOperations to a new runtime");this.appendOperations=new si(e.document),this.updateOperations=new oi(e.document)}}getAppendOperations(){return this.appendOperations}getDOM(){return z(this.updateOperations,"Attempted to get DOM updateOperations, but they were not provided by the environment. You may be attempting to rerender in an environment which does not support rerendering, such as SSR.")}begin(){K(!this[hi],"A glimmer transaction was begun, but one already exists. You may have a nested transaction, possibly caused by an earlier runtime exception while rendering. Please check your console for the stack trace of any prior exceptions."),this.debugRenderTree?.begin(),this[hi]=new mi}get transaction(){return z(this[hi],"must be in a transaction")}didCreate(e){this.transaction.didCreate(e)}didUpdate(e){this.transaction.didUpdate(e)}scheduleInstallModifier(e){this.isInteractive&&this.transaction.scheduleInstallModifier(e)}scheduleUpdateModifier(e){this.isInteractive&&this.transaction.scheduleUpdateModifier(e)}commit(){let e=this.transaction;this[hi]=null,e.commit(),this.debugRenderTree?.commit(),this.delegate.onTransactionCommit()}}function gi(e,t,n,s){return{env:new fi(e,t),program:new kt(n.constants,n.heap),resolver:s}}function bi(e,t){if(e[hi])t();else{e.begin();try{t()}finally{e.commit()}}}function yi(e){return Ze(e,{})}const ki=yi((({positional:e})=>A((()=>Cs(e)),null,"array"))),vi=e=>(e=>null==e||"function"!=typeof e.toString)(e)?"":String(e),wi=yi((({positional:e})=>A((()=>Cs(e).map(vi).join("")),null,"concat"))),Si=he("`fn` helper"),Ei=yi((({positional:e})=>{let t=i(e[0],xi);return A((()=>(...n)=>{let[s,...i]=Cs(e);if(xi(t),j(t)){let e=i.length>0?i[0]:n[0];return G(t,e)}return s.call(Si,...i,...n)}),null,"fn")}));function xi(e){if(!e||!j(e)&&"function"!=typeof _(e))throw new Error(`You must pass a function as the \`fn\` helper's first argument, you passed ${e?_(e):e}. While rendering:\n\n${e?.debugLabel}`)}const Ci=yi((({positional:e})=>{let t=e[0]??B,n=e[1]??B;return A((()=>{let e=_(t);if(me(e))return Fe(e,String(_(n)))}),(e=>{let s=_(t);if(me(s))return We(s,String(_(n)),e)}),"get")})),Ti=yi((({named:e})=>{let t=A((()=>xs(e)),null,"hash"),n=new Map;for(let t in e)n.set(t,e[t]);return t.children=n,t}));let Ni=new WeakMap;function Bi(e){return ft(Ni.get(e))}class _i{argsCache;constructor(e,t=(()=>Ls)){let n=mt((()=>t(e)));Ni.set(this,n),Object.freeze(this)}get named(){return Bi(this).named||Rs}get positional(){return Bi(this).positional||Ms}}function Ai(e,t,n){if("object"!=typeof e||null===e)throw new Error(`Expected a context object to be passed as the first parameter to invokeHelper, got ${e}`);const s=vt(e),i=qe(t);if(!i)throw new Error(`Expected a helper definition to be passed as the second parameter to invokeHelper, but no helper manager was found. The definition value that was passed was \`${ne(t)}\`. Did you use setHelperManager to associate a helper manager with this value?`);if("function"==typeof i)throw new Error("Found a helper manager, but it was an internal built-in helper manager. `invokeHelper` does not support internal helpers yet.");const r=i.getDelegateFor(s);let a,o=new _i(e,n),l=r.createHelper(t,o);if(!et(r))throw new Error("TODO: unreachable, to be implemented with hasScheduledEffect");if(a=mt((()=>{if($e(a)||He(a))throw new Error("You attempted to get the value of a helper after the helper was destroyed, which is not allowed");return r.getValue(l)})),Ue(e,a),tt(r)){let e=r.getDestroyable(l);Ue(a,e)}return a}const Ri=he("`on` modifier");class Mi{tag=gt();element;args;listener=null;constructor(e,t){this.element=e,this.args=t,De(this,(()=>{let{element:e,listener:t}=this;if(t){let{eventName:n,callback:s,options:i}=t;Di(e,n,s,i)}}))}updateListener(){let{element:e,args:t,listener:n}=this;K(t.positional[0],"You must pass a valid DOM event name as the first argument to the `on` modifier");let s=i(_(t.positional[0]),d,(()=>"You must pass a valid DOM event name as the first argument to the `on` modifier"));K(t.positional[1],"You must pass a function as the second argument to the `on` modifier");let r,a,o,l=i(_(t.positional[1]),y,(e=>`You must pass a function as the second argument to the \`on\` modifier; you passed ${null===e?"null":typeof e}. While rendering:\n\n${t.positional[1]?.debugLabel??"{unlabeled value}"}`));if(2!==t.positional.length)throw new Error(`You can only pass two positional arguments (event name and callback) to the \`on\` modifier, but you provided ${t.positional.length}. Consider using the \`fn\` helper to provide additional arguments to the \`on\` callback.`);{let{once:e,passive:n,capture:s,...l}=xs(t.named);if(r=i(e,f(T,N),(e=>`You must pass a boolean or undefined as the \`once\` argument to the \`on\` modifier; you passed ${e}. While rendering:\n\n${t.named.once.debugLabel??"{unlabeled value}"}`)),a=i(n,f(T,N),(e=>`You must pass a boolean or undefined as the \`passive\` argument to the \`on\` modifier; you passed ${e}. While rendering:\n\n${t.named.passive.debugLabel??"{unlabeled value}"}`)),o=i(s,f(T,N),(e=>`You must pass a boolean or undefined as the \`capture\` argument to the \`on\` modifier; you passed ${e}. While rendering:\n\n${t.named.capture.debugLabel??"{unlabeled value}"}`)),Object.keys(l).length>0)throw new Error(`You can only \`once\`, \`passive\` or \`capture\` named arguments to the \`on\` modifier, but you provided ${Object.keys(l).join(", ")}.`)}let c,u=!1;if(u=null===n||(s!==n.eventName||l!==n.userProvidedCallback||r!==n.once||a!==n.passive||o!==n.capture),u&&(void 0===r&&void 0===a&&void 0===o||(c={once:r,passive:a,capture:o})),u){let t=l;if(t=l.bind(Ri),a){let e=t;t=t=>(t.preventDefault=()=>{throw new Error(`You marked this listener as 'passive', meaning that you must not call 'event.preventDefault()': \n\n${l.name??"{anonymous function}"}`)},e(t))}this.listener={eventName:s,callback:t,userProvidedCallback:l,once:r,passive:a,capture:o,options:c},n&&Di(e,n.eventName,n.callback,n.options),function(e,t,n,s){Li++,e.addEventListener(t,n,s)}(e,s,t,c)}}}let Li=0,Oi=0;function Di(e,t,n,s){Oi++,e.removeEventListener(t,n,s)}const Vi=nt(new class{getDebugName(){return"on"}getDebugInstance(){return null}get counters(){return{adds:Li,removes:Oi}}create(e,t,n,s){return new Mi(t,s)}getTag({tag:e}){return e}install(e){e.updateListener()}update(e){e.updateListener()}getDestroyable(e){return e}},{});class Ui{currentOpSize=0;constructor(e,t,n,s,i){this.stack=e,this.heap=t,this.program=n,this.externs=s,this.registers=i}fetchRegister(e){return this.registers[e]}loadRegister(e,t){this.registers[e]=t}setPc(e){K("number"==typeof e&&!isNaN(e),"pc is set to a number"),this.registers[ve]=e}pushFrame(){this.stack.push(this.registers[Se]),this.stack.push(this.registers[Ee]),this.registers[Ee]=this.registers[we]-1}popFrame(){this.registers[we]=this.registers[Ee]-1,this.registers[Se]=this.stack.get(0),this.registers[Ee]=this.stack.get(1)}pushSmallFrame(){this.stack.push(this.registers[Se])}popSmallFrame(){this.registers[Se]=this.stack.pop()}goto(e){this.setPc(this.target(e))}target(e){return this.registers[ve]+e-this.currentOpSize}call(e){K(e<4294967295,"Jumping to placeholder address"),this.registers[Se]=this.registers[ve],this.setPc(this.heap.getaddr(e))}returnTo(e){this.registers[Se]=this.target(e)}return(){this.setPc(this.registers[Se])}nextStatement(){let{registers:e,program:t}=this,n=e[ve];if(K("number"==typeof n,"pc is a number"),-1===n)return null;let s=t.opcode(n),i=this.currentOpSize=s.size;return this.registers[ve]+=i,s}evaluateOuter(e,t){if(wt){let{externs:{debugBefore:n,debugAfter:s}}=this,i=n(e);this.evaluateInner(e,t),s(i)}else this.evaluateInner(e,t)}evaluateInner(e,t){e.isMachine?this.evaluateMachine(e):this.evaluateSyscall(e,t)}evaluateMachine(e){switch(e.type){case Re.PushFrame:return this.pushFrame();case Re.PopFrame:return this.popFrame();case Re.InvokeStatic:return this.call(e.op1);case Re.InvokeVirtual:return this.call(this.stack.pop());case Re.Jump:return this.goto(e.op1);case Re.Return:return this.return();case Re.ReturnTo:return this.returnTo(e.op1)}}evaluateSyscall(e,t){Sn.evaluate(t,e,e.type)}}class Ii{env;dom;alwaysRevalidate;frameStack=new q;constructor(e,{alwaysRevalidate:t=!1}){this.env=e,this.dom=e.getDOM(),this.alwaysRevalidate=t}execute(e,t){{let n=!0;try{bt.runInTrackingTransaction((()=>this._execute(e,t)),"- While rendering:"),n=!1}finally{n&&console.error(`\n\nError occurred:\n\n${yt()}\n\n`)}}}_execute(e,t){let{frameStack:n}=this;for(this.try(e,t);!n.isEmpty();){let e=this.frame.nextStatement();void 0!==e?e.evaluate(this):n.pop()}}get frame(){return z(this.frameStack.current,"bug: expected a frame")}goto(e){this.frame.goto(e)}try(e,t){this.frameStack.push(new Fi(e,t))}throw(){this.frame.handleException(),this.frameStack.pop()}}class $i{constructor(e,t){this.state=e,this.resumeCallback=t}resume(e,t){return this.resumeCallback(e,this.state,t)}}class Hi{children;bounds;constructor(e,t,n,s){this.state=e,this.runtime=t,this.children=s,this.bounds=n}parentElement(){return this.bounds.parentElement()}firstNode(){return this.bounds.firstNode()}lastNode(){return this.bounds.lastNode()}evaluate(e){e.try(this.children,null)}}class ji extends Hi{type="try";evaluate(e){e.try(this.children,this)}handleException(){let{state:e,bounds:t,runtime:n}=this;je(this);let s=gn.resume(n.env,t),i=e.resume(n,s),r=[],a=this.children=[],o=i.execute((e=>{e.pushUpdating(r),e.updateWith(this),e.pushUpdating(a)}));Ue(this,o.drop)}}class Gi extends ji{retained=!1;index=-1;constructor(e,t,n,s,i,r){super(e,t,n,[]),this.key=s,this.memo=i,this.value=r}updateReferences(e){this.retained=!0,G(this.value,e.value),G(this.memo,e.memo)}shouldRemove(){return!this.retained}reset(){this.retained=!1}}class Pi extends Hi{type="list-block";opcodeMap=new Map;marker=null;lastIterator;constructor(e,t,n,s,i){super(e,t,n,s),this.iterableRef=i,this.lastIterator=_(i)}initializeChild(e){e.index=this.children.length-1,this.opcodeMap.set(e.key,e)}evaluate(e){let t=_(this.iterableRef);if(this.lastIterator!==t){let{bounds:n}=this,{dom:s}=e,i=this.marker=s.createComment("");s.insertAfter(n.parentElement(),i,z(n.lastNode(),"can't insert after an empty bounds")),this.sync(t),this.parentElement().removeChild(i),this.marker=null,this.lastIterator=t}super.evaluate(e)}sync(e){let{opcodeMap:t,children:n}=this,s=0,i=0;for(this.children=this.bounds.boundList=[];;){let r=e.next();if(null===r)break;let a=n[s],{key:o}=r;for(;void 0!==a&&!0===a.retained;)a=n[++s];if(void 0!==a&&a.key===o)this.retainItem(a,r),s++;else if(t.has(o)){let e=t.get(o);if(e.index<i)this.moveItem(e,r,a);else{i=e.index;let t=!1;for(let e=s+1;e<i;e++)if(!1===W(n[e]).retained){t=!0;break}!1===t?(this.retainItem(e,r),s=i+1):(this.moveItem(e,r,a),s++)}}else this.insertItem(r,a)}for(const e of n)!1===e.retained?this.deleteItem(e):e.reset()}retainItem(e,t){wt&&fe("list-updates",["retain",t.key]);let{children:n}=this;G(e.memo,t.memo),G(e.value,t.value),e.retained=!0,e.index=n.length,n.push(e)}insertItem(e,t){wt&&fe("list-updates",["insert",e.key]);let{opcodeMap:n,bounds:s,state:i,runtime:r,children:a}=this,{key:o}=e,l=void 0===t?this.marker:t.firstNode(),c=gn.forInitialRender(r.env,{element:s.parentElement(),nextSibling:l});i.resume(r,c).execute((t=>{t.pushUpdating();let s=t.enterItem(e);s.index=a.length,a.push(s),n.set(o,s),Ue(this,s)}))}moveItem(e,t,n){let s,i,{children:r}=this;if(G(e.memo,t.memo),G(e.value,t.value),e.retained=!0,void 0===n?Ot(e,this.marker):(s=e.lastNode().nextSibling,i=n.firstNode(),s!==i&&Ot(e,i)),e.index=r.length,r.push(e),wt){fe("list-updates",[s&&s===i?"move-retain":"move",t.key])}}deleteItem(e){wt&&fe("list-updates",["delete",e.key]),Ve(e),Dt(e),this.opcodeMap.delete(e.key)}}class Fi{current=0;constructor(e,t){this.ops=e,this.exceptionHandler=t}goto(e){this.current=e}nextStatement(){return this.ops[this.current++]}handleException(){this.exceptionHandler&&this.exceptionHandler.handleException()}}class Wi{constructor(e,t,n,s){this.env=e,this.updating=t,this.bounds=n,this.drop=s,Ue(this,s),De(this,(()=>Dt(this.bounds)))}rerender({alwaysRevalidate:e=!1}={alwaysRevalidate:!1}){let{env:t,updating:n}=this;new Ii(t,{alwaysRevalidate:e}).execute(n,this)}parentElement(){return this.bounds.parentElement()}firstNode(){return this.bounds.firstNode()}lastNode(){return this.bounds.lastNode()}handleException(){throw"this should never happen"}}class zi{static restore(e){return new this(e.slice(),[0,-1,e.length-1,0])}[Bt];constructor(e=[],t){this.stack=e,this[Bt]=t,wt&&Object.seal(this)}push(e){this.stack[++this[Bt][we]]=e}dup(e=this[Bt][we]){this.stack[++this[Bt][we]]=this.stack[e]}copy(e,t){this.stack[t]=this.stack[e]}pop(e=1){let t=this.stack[this[Bt][we]];return this[Bt][we]-=e,t}peek(e=0){return this.stack[this[Bt][we]-e]}get(e,t=this[Bt][Ee]){return this.stack[t+e]}set(e,t,n=this[Bt][Ee]){this.stack[n+t]=e}slice(e,t){return this.stack.slice(e,t)}capture(e){let t=this[Bt][we]+1,n=t-e;return this.stack.slice(n,t)}reset(){this.stack.length=0}toArray(){return this.stack.slice(this[Bt][Ee],this[Bt][we]+1)}}class Yi{scope=new q;dynamicScope=new q;updating=new q;cache=new q;list=new q}class Ji{[Nt]=new Yi;[_t];destructor;[Tt]=new q;[At];[Rt];[Ct];get stack(){return this[Ct].stack}get pc(){return this[Ct].fetchRegister(ve)}s0=null;s1=null;t0=null;t1=null;v0=null;fetch(e){let t=this.fetchValue(e);this.stack.push(t)}load(e){let t=this.stack.pop();this.loadValue(e,t)}fetchValue(e){if(Me(e))return this[Ct].fetchRegister(e);switch(e){case Oe:return this.s0;case Le:return this.s1;case Ce:return this.t0;case Te:return this.t1;case Be:return this.v0}}loadValue(e,t){switch(Me(e)&&this[Ct].loadRegister(e,t),e){case Oe:this.s0=t;break;case Le:this.s1=t;break;case Ce:this.t0=t;break;case Te:this.t1=t;break;case Be:this.v0=t}}pushFrame(){this[Ct].pushFrame()}popFrame(){this[Ct].popFrame()}goto(e){this[Ct].goto(e)}call(e){this[Ct].call(e)}returnTo(e){this[Ct].returnTo(e)}return(){this[Ct].return()}constructor(e,{pc:t,scope:n,dynamicScope:s,stack:i},r,a){this.runtime=e,this.elementStack=r,this.context=a,ze(),this.resume=Ki(a);let o=zi.restore(i);K("number"==typeof t,"pc is a number"),o[Bt][ve]=t,o[Bt][we]=i.length-1,o[Bt][Ee]=-1,this[_t]=this.program.heap,this[At]=this.program.constants,this.elementStack=r,this[Nt].scope.push(n),this[Nt].dynamicScope.push(s),this[Rt]=new fs,this[Ct]=new Ui(o,this[_t],e.program,{debugBefore:e=>Sn.debugBefore(this,e),debugAfter:e=>{Sn.debugAfter(this,e)}},o[Bt]),this.destructor={},this[Tt].push(this.destructor)}static initial(e,t,{handle:n,self:s,dynamicScope:i,treeBuilder:r,numSymbols:a,owner:o}){let l=xt.root(s,a,o),c=qi(e.program.heap.getaddr(n),l,i),u=Ki(t)(e,c,r);return u.pushUpdating(),u}static empty(e,{handle:t,treeBuilder:n,dynamicScope:s,owner:i},r){let a=Ki(r)(e,qi(e.program.heap.getaddr(t),xt.root(B,0,i),s),n);return a.pushUpdating(),a}resume;compile(e){return ge(e.compile(this.context))}get program(){return this.runtime.program}get env(){return this.runtime.env}captureState(e,t=this[Ct].fetchRegister(ve)){return{pc:t,scope:this.scope(),dynamicScope:this.dynamicScope(),stack:this.stack.capture(e)}}capture(e,t=this[Ct].fetchRegister(ve)){return new $i(this.captureState(e,t),this.resume)}beginCacheGroup(e){let t=this.updating(),n=new Un;t.push(n),t.push(new In(e)),this[Nt].cache.push(n),st(e)}commitCacheGroup(){let e=this.updating(),t=z(this[Nt].cache.pop(),"VM BUG: Expected a cache group"),n=it();e.push(new $n(t)),t.finalize(n,e.length)}enter(e){let t=this.capture(e),n=this.elements().pushUpdatableBlock(),s=new ji(t,this.runtime,n,[]);this.didEnter(s)}enterItem({key:e,value:t,memo:n}){let{stack:s}=this,i=P(t),r=P(n);s.push(i),s.push(r);let a=this.capture(2),o=this.elements().pushUpdatableBlock(),l=new Gi(a,this.runtime,o,e,r,i);return this.didEnter(l),l}registerItem(e){this.listBlock().initializeChild(e)}enterList(e,t){let n=[],s=this[Ct].target(t),i=this.capture(0,s),r=this.elements().pushBlockList(n),a=new Pi(i,this.runtime,r,n,e);this[Nt].list.push(a),this.didEnter(a)}didEnter(e){this.associateDestroyable(e),this[Tt].push(e),this.updateWith(e),this.pushUpdating(e.children)}exit(){this[Tt].pop(),this.elements().popBlock(),this.popUpdating()}exitList(){this.exit(),this[Nt].list.pop()}pushUpdating(e=[]){this[Nt].updating.push(e)}popUpdating(){return z(this[Nt].updating.pop(),"can't pop an empty stack")}updateWith(e){this.updating().push(e)}listBlock(){return z(this[Nt].list.current,"expected a list block")}associateDestroyable(e){let t=z(this[Tt].current,"Expected destructor parent");Ue(t,e)}tryUpdating(){return this[Nt].updating.current}updating(){return z(this[Nt].updating.current,"expected updating opcode on the updating opcode stack")}elements(){return this.elementStack}scope(){return z(this[Nt].scope.current,"expected scope on the scope stack")}dynamicScope(){return z(this[Nt].dynamicScope.current,"expected dynamic scope on the dynamic scope stack")}pushChildScope(){this[Nt].scope.push(this.scope().child())}pushDynamicScope(){let e=this.dynamicScope().child();return this[Nt].dynamicScope.push(e),e}pushRootScope(e,t){let n=xt.sized(e,t);return this[Nt].scope.push(n),n}pushScope(e){this[Nt].scope.push(e)}popScope(){this[Nt].scope.pop()}popDynamicScope(){this[Nt].dynamicScope.pop()}getOwner(){return this.scope().owner}getSelf(){return this.scope().getSelf()}referenceForSymbol(e){return this.scope().getSymbol(e)}execute(e){{let t=!0;try{let n=this._execute(e);return t=!1,n}finally{if(t){let e=this.elements();for(;e.hasBlocks;)e.popBlock();console.error(`\n\nError occurred:\n\n${yt()}\n\n`)}}}}_execute(e){let t;St&&X.log(`EXECUTING FROM ${this[Ct].fetchRegister(ve)}`),e&&e(this);do{t=this.next()}while(!t.done);return t.value}next(){let e,{env:t,elementStack:n}=this,s=this[Ct].nextStatement();return null!==s?(this[Ct].evaluateOuter(s,this),e={done:!1,value:null}):(this.stack.reset(),e={done:!0,value:new Wi(t,this.popUpdating(),n.popBlock(),this.destructor)}),e}bindDynamicScope(e){let t=this.dynamicScope();for(const n of be(e))t.set(n,this.stack.pop())}}function qi(e,t,n){return{pc:e,scope:t,dynamicScope:n,stack:[]}}function Ki(e){return(t,n,s)=>new Ji(t,n,s,e)}class Xi{constructor(e){this.vm=e}next(){return this.vm.next()}sync(){return bt.runInTrackingTransaction((()=>this.vm.execute()),"- While rendering:")}}function Qi(e,t){let n;return bi(e,(()=>n=t.sync())),n}function Zi(e,t,n,s,i,r,a=new Et){let o=ge(r.compile(t)),l=r.symbolTable.symbols.length,c=Ji.initial(e,t,{self:s,dynamicScope:a,treeBuilder:i,handle:o,numSymbols:l,owner:n});return new Xi(c)}function er(e,t,n,s,i,r={},a=new Et){return function(e,t,n,s,i){const r=Object.keys(i).map((e=>[e,i[e]])),a=["main","else","attrs"],o=r.map((([e])=>`@${e}`));let l=e[At].component(s,n);e.pushFrame();for(let t=0;t<3*a.length;t++)e.stack.push(null);e.stack.push(null),r.forEach((([,t])=>{e.stack.push(t)})),e[Rt].setup(e.stack,o,a,0,!0);const c=z(l.compilable,"BUG: Expected the root component rendered with renderComponent to have an associated template, set with setComponentTemplate"),u={handle:ge(c.compile(t)),symbolTable:c.symbolTable};return e.stack.push(e[Rt]),e.stack.push(u),e.stack.push(l),new Xi(e)}(Ji.empty(e,{treeBuilder:t,handle:n.stdlib.main,dynamicScope:a,owner:s},n),n,s,i,function(e){const t=R(e,"args");return Object.keys(e).reduce(((e,n)=>(e[n]=$(t,n),e)),{})}(r))}const tr="%+b:0%";function nr(e){return e.nodeValue===tr}class sr extends Mt{candidate=null;openBlockDepth;injectedOmittedNode=!1;constructor(e,t,n){super(e,t),this.startingBlockDepth=n,this.openBlockDepth=n-1}}class ir extends gn{unmatchedAttributes=null;blockDepth=0;startingBlockOffset;constructor(e,t,n){if(super(e,t,n),n)throw new Error("Rehydration with nextSibling not supported");let s=this.currentCursor.element.firstChild;for(;null!==s&&!rr(s);)s=s.nextSibling;K(s,"Must have opening comment for rehydration."),this.candidate=s;const i=or(s);if(0!==i){const e=i-1,t=this.dom.createComment(`%+b:${e}%`);s.parentNode.insertBefore(t,this.candidate);let n=s.nextSibling;for(;null!==n&&(!ar(n)||or(n)!==i);)n=n.nextSibling;K(n,"Must have closing comment for starting block comment");const r=this.dom.createComment(`%-b:${e}%`);s.parentNode.insertBefore(r,n.nextSibling),this.candidate=t,this.startingBlockOffset=e}else this.startingBlockOffset=0}get currentCursor(){return this[fn].current}get candidate(){return this.currentCursor?this.currentCursor.candidate:null}set candidate(e){this.currentCursor.candidate=e}disableRehydration(e){const t=this.currentCursor;t.candidate=null,t.nextSibling=e}enableRehydration(e){const t=this.currentCursor;t.candidate=e,t.nextSibling=null}pushElement(e,t=null){const n=new sr(e,t,this.blockDepth||0);null!==this.candidate&&(n.candidate=e.firstChild,this.candidate=e.nextSibling),this[fn].push(n)}clearMismatch(e){let t=e;const n=this.currentCursor;if(null!==n){const e=n.openBlockDepth;if(e>=n.startingBlockDepth)for(;t;){if(ar(t)){if(e>=lr(t,this.startingBlockOffset))break}t=this.remove(t)}else for(;null!==t;)t=this.remove(t);this.disableRehydration(t)}}__openBlock(){const{currentCursor:e}=this;if(null===e)return;const t=this.blockDepth;this.blockDepth++;const{candidate:n}=e;if(null===n)return;const{tagName:s}=e.element;rr(n)&&lr(n,this.startingBlockOffset)===t?(this.candidate=this.remove(n),e.openBlockDepth=t):"TITLE"!==s&&"SCRIPT"!==s&&"STYLE"!==s&&this.clearMismatch(n)}__closeBlock(){const{currentCursor:e}=this;if(null===e)return;const t=e.openBlockDepth;this.blockDepth--;const{candidate:n}=e;let s=!1;if(null!==n)if(s=!0,ar(n)&&lr(n,this.startingBlockOffset)===t){const t=this.remove(n);this.candidate=t,e.openBlockDepth--}else this.clearMismatch(n),s=!1;if(!1===s){const t=e.nextSibling;if(null!==t&&ar(t)&&lr(t,this.startingBlockOffset)===this.blockDepth){const n=this.remove(t);this.enableRehydration(n),e.openBlockDepth--}}}__appendNode(e){const{candidate:t}=this;return t||super.__appendNode(e)}__appendHTML(e){const t=this.markerBounds();if(t){const e=t.firstNode(),n=t.lastNode(),s=new Lt(this.element,e.nextSibling,n.previousSibling),i=this.remove(e);return this.remove(n),null!==i&&dr(i)&&(this.candidate=this.remove(i),null!==this.candidate&&this.clearMismatch(this.candidate)),s}return super.__appendHTML(e)}remove(e){const t=z(e.parentNode,"cannot remove a detached node"),n=e.nextSibling;return t.removeChild(e),n}markerBounds(){const e=this.candidate;if(e&&ur(e)){const t=e;let n=z(t.nextSibling,"BUG: serialization markers must be paired");for(;n&&!ur(n);)n=z(n.nextSibling,"BUG: serialization markers must be paired");return new Lt(this.element,t,n)}return null}__appendText(e){const{candidate:t}=this;return t?3===t.nodeType?(t.nodeValue!==e&&(t.nodeValue=e),this.candidate=t.nextSibling,t):function(e){return 8===e.nodeType&&"%|%"===e.nodeValue}(t)||dr(t)&&""===e?(this.candidate=this.remove(t),this.__appendText(e)):(this.clearMismatch(t),super.__appendText(e)):super.__appendText(e)}__appendComment(e){const t=this.candidate;return t&&8===t.nodeType?(t.nodeValue!==e&&(t.nodeValue=e),this.candidate=t.nextSibling,t):(t&&this.clearMismatch(t),super.__appendComment(e))}__openElement(e){const t=this.candidate;if(t&&cr(t)&&function(e,t){if(e.namespaceURI===Y)return e.tagName===t;return e.tagName===t.toUpperCase()}(t,e))return this.unmatchedAttributes=[].slice.call(t.attributes),t;if(t){if(cr(t)&&"TBODY"===t.tagName)return this.pushElement(t,null),this.currentCursor.injectedOmittedNode=!0,this.__openElement(e);this.clearMismatch(t)}return super.__openElement(e)}__setAttribute(e,t,n){const s=this.unmatchedAttributes;if(s){const n=pr(s,e);if(n)return n.value!==t&&(n.value=t),void s.splice(s.indexOf(n),1)}return super.__setAttribute(e,t,n)}__setProperty(e,t){const n=this.unmatchedAttributes;if(n){const s=pr(n,e);if(s)return s.value!==t&&(s.value=t),void n.splice(n.indexOf(s),1)}return super.__setProperty(e,t)}__flushElement(e,t){const{unmatchedAttributes:n}=this;if(n){for(const e of n)this.constructing.removeAttribute(e.name);this.unmatchedAttributes=null}else super.__flushElement(e,t)}willCloseElement(){const{candidate:e,currentCursor:t}=this;null!==e&&this.clearMismatch(e),t&&t.injectedOmittedNode&&this.popElement(),super.willCloseElement()}getMarker(e,t){const n=e.querySelector(`script[glmr="${t}"]`);return n?pe(n):null}__pushRemoteElement(e,t,n){const s=this.getMarker(J(e,"HTML"),t);if(K(!s||s.parentNode===e,"expected remote element marker's parent node to match remote element"),void 0===n){for(;null!==e.firstChild&&e.firstChild!==s;)this.remove(e.firstChild);n=null}const i=new sr(e,null,this.blockDepth);this[fn].push(i),null===s?this.disableRehydration(n):this.candidate=this.remove(s);const r=new yn(e);return this.pushLiveBlock(r,!0)}didAppendBounds(e){if(super.didAppendBounds(e),this.candidate){const t=e.lastNode();this.candidate=t&&t.nextSibling}return e}}function rr(e){return e.nodeType===ye&&0===e.nodeValue.lastIndexOf("%+b:",0)}function ar(e){return e.nodeType===ye&&0===e.nodeValue.lastIndexOf("%-b:",0)}function or(e){return parseInt(e.nodeValue.slice(4),10)}function lr(e,t){return or(e)-t}function cr(e){return 1===e.nodeType}function ur(e){return 8===e.nodeType&&"%glmr%"===e.nodeValue}function dr(e){return 8===e.nodeType&&"% %"===e.nodeValue}function pr(e,t){for(const n of e)if(n.name===t)return n}function hr(e,t){return ir.forInitialRender(e,t)}export{Lt as ConcreteBounds,Rn as CurriedValue,Mt as CursorImpl,ci as DOMChanges,si as DOMTreeConstruction,rn as DynamicAttribute,Et as DynamicScopeImpl,Ls as EMPTY_ARGS,Rs as EMPTY_NAMED,Ms as EMPTY_POSITIONAL,fi as EnvironmentImpl,oi as IDOMChanges,Ji as LowLevelVM,gn as NewElementBuilder,xt as PartialScopeImpl,ir as RehydrateBuilder,yn as RemoteLiveBlock,tr as SERIALIZATION_FIRST_NODE_STRING,an as SimpleDynamicAttribute,Ys as TEMPLATE_ONLY_COMPONENT_MANAGER,Js as TemplateOnlyComponent,zs as TemplateOnlyComponentManager,kn as UpdatableBlockImpl,Ii as UpdatingVM,ki as array,Dt as clear,wn as clientBuilder,wi as concat,Es as createCapturedArgs,Ln as curry,nn as dynamicAttribute,Ei as fn,Ci as get,Ti as hash,bi as inTransaction,Ai as invokeHelper,nr as isSerializationFirstNode,ai as isWhitespace,jt as normalizeProperty,Vi as on,hr as rehydrationBuilder,Ts as reifyArgs,xs as reifyNamed,Cs as reifyPositional,er as renderComponent,Zi as renderMain,Qi as renderSync,Ps as resetDebuggerCallback,gi as runtimeContext,Gs as setDebuggerCallback,qs as templateOnlyComponent};
//# sourceMappingURL=index.js.map
