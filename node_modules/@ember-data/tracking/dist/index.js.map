{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { createCache, getValue } from '@glimmer/tracking/primitives/cache';\n\nimport { assert } from '@warp-drive/build-config/macros';\n\nexport { transact, memoTransact, untracked } from './-private';\n\n// temporary so we can remove the glimmer and ember imports elsewhere\n// eslint-disable-next-line no-restricted-imports\nexport { dependentKeyCompat as compat } from '@ember/object/compat';\n\nexport function cached<T extends object, K extends keyof T & string>(\n  target: T,\n  key: K,\n  descriptor: PropertyDescriptor\n) {\n  // Error on `@cached()`, `@cached(...args)`, and `@cached propName = value;`\n  assert(\n    'You attempted to use @cached(), which is not necessary nor supported. Remove the parentheses and you will be good to go!',\n    target !== undefined\n  );\n  assert(\n    `You attempted to use @cached on with ${arguments.length > 1 ? 'arguments' : 'an argument'} ( @cached(${Array.from(\n      arguments\n    )\n      .map((d) => `'${d}'`)\n      .join(\n        ', '\n      )}), which is not supported. Dependencies are automatically tracked, so you can just use ${'`@cached`'}`,\n    typeof target === 'object' && typeof key === 'string' && typeof descriptor === 'object' && arguments.length === 3\n  );\n  assert(\n    `The @cached decorator must be applied to getters. '${key}' is not a getter.`,\n    typeof descriptor.get === 'function'\n  );\n\n  const caches = new WeakMap<object, object>();\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  const getter = descriptor.get;\n  descriptor.get = function () {\n    if (!caches.has(this)) caches.set(this, createCache(getter.bind(this)));\n    return getValue<unknown>(caches.get(this) as Parameters<typeof getValue>[0]);\n  };\n}\n\nexport { createCache, getValue };\n"],"names":["cached","target","key","descriptor","macroCondition","getGlobalConfig","WarpDrive","env","DEBUG","test","Error","undefined","arguments","length","Array","from","map","d","join","get","caches","WeakMap","getter","has","set","createCache","bind","getValue"],"mappings":";;;;;;AAUO,SAASA,MAAMA,CACpBC,MAAS,EACTC,GAAM,EACNC,UAA8B,EAC9B;AACA;EACAC,cAAA,CAAAC,eAAA,EAAAC,CAAAA,SAAA,CAAAC,GAAA,CAAAC,KAAA,CAAA,GAAA,CAAAC,IAAA,IAAA;AAAA,IAAA,IAAA,CAAAA,IAAA,EAAA;MAAA,MAAAC,IAAAA,KAAA,CACE,0HAA0H,CAAA,CAAA;AAAA,KAAA;GAC1HT,EAAAA,MAAM,KAAKU,SAAS,CAAA,GAAA,EAAA,CAAA;EAEtBP,cAAA,CAAAC,eAAA,EAAAC,CAAAA,SAAA,CAAAC,GAAA,CAAAC,KAAA,CAAA,GAAA,CAAAC,IAAA,IAAA;AAAA,IAAA,IAAA,CAAAA,IAAA,EAAA;AAAA,MAAA,MAAA,IAAAC,KAAA,CACG,CAAuCE,qCAAAA,EAAAA,SAAS,CAACC,MAAM,GAAG,CAAC,GAAG,WAAW,GAAG,aAAc,CAAaC,WAAAA,EAAAA,KAAK,CAACC,IAAI,CAChHH,SACF,CAAC,CACEI,GAAG,CAAEC,CAAC,IAAM,IAAGA,CAAE,CAAA,CAAA,CAAE,CAAC,CACpBC,IAAI,CACH,IACF,CAAE,CAAA,uFAAA,EAAyF,WAAY,CAAC,CAAA,CAAA,CAAA;AAAA,KAAA;AAAA,GAAA,EAC1G,OAAOjB,MAAM,KAAK,QAAQ,IAAI,OAAOC,GAAG,KAAK,QAAQ,IAAI,OAAOC,UAAU,KAAK,QAAQ,IAAIS,SAAS,CAACC,MAAM,KAAK,CAAC,CAAA,GAAA,EAAA,CAAA;EAEnHT,cAAA,CAAAC,eAAA,EAAAC,CAAAA,SAAA,CAAAC,GAAA,CAAAC,KAAA,CAAA,GAAA,CAAAC,IAAA,IAAA;AAAA,IAAA,IAAA,CAAAA,IAAA,EAAA;AAAA,MAAA,MAAA,IAAAC,KAAA,CACG,CAAqDR,mDAAAA,EAAAA,GAAI,CAAmB,kBAAA,CAAA,CAAA,CAAA;AAAA,KAAA;AAAA,GAAA,EAC7E,OAAOC,UAAU,CAACgB,GAAG,KAAK,UAAU,CAAA,GAAA,EAAA,CAAA;AAGtC,EAAA,MAAMC,MAAM,GAAG,IAAIC,OAAO,EAAkB,CAAA;AAC5C;AACA,EAAA,MAAMC,MAAM,GAAGnB,UAAU,CAACgB,GAAG,CAAA;EAC7BhB,UAAU,CAACgB,GAAG,GAAG,YAAY;IAC3B,IAAI,CAACC,MAAM,CAACG,GAAG,CAAC,IAAI,CAAC,EAAEH,MAAM,CAACI,GAAG,CAAC,IAAI,EAAEC,WAAW,CAACH,MAAM,CAACI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;IACvE,OAAOC,QAAQ,CAAUP,MAAM,CAACD,GAAG,CAAC,IAAI,CAAmC,CAAC,CAAA;GAC7E,CAAA;AACH;;;;"}