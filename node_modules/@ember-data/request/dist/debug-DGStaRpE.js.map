{"version":3,"file":"debug-DGStaRpE.js","sources":["../src/-private/promise-cache.ts","../src/-private/utils.ts","../src/-private/future.ts","../src/-private/context.ts","../src/-private/debug.ts"],"sourcesContent":["import { getOrSetUniversal } from '@warp-drive/core-types/-private';\n\nexport type CacheResult<T = unknown, E = unknown> = { isError: true; result: E } | { isError: false; result: T };\n\nexport type Awaitable<T = unknown, E = unknown> = {\n  then: (onFulfilled: (value: T) => unknown, onRejected: (reason: E) => unknown) => unknown;\n  catch: (onRejected: (reason: E) => unknown) => unknown;\n  finally: (onFinally: () => unknown) => unknown;\n};\n\nexport const PromiseCache = getOrSetUniversal('PromiseCache', new WeakMap<Awaitable, CacheResult>());\nexport const RequestMap = getOrSetUniversal('RequestMap', new Map<number, CacheResult>());\n\nexport function setRequestResult(requestId: number, result: CacheResult) {\n  RequestMap.set(requestId, result);\n}\nexport function clearRequestResult(requestId: number) {\n  RequestMap.delete(requestId);\n}\nexport function getRequestResult(requestId: number): CacheResult | undefined {\n  return RequestMap.get(requestId);\n}\n\nexport function setPromiseResult(promise: Promise<unknown> | Awaitable, result: CacheResult) {\n  PromiseCache.set(promise, result);\n}\n\nexport function getPromiseResult<T, E>(promise: Promise<T> | Awaitable<T, E>): CacheResult<T, E> | undefined {\n  return PromiseCache.get(promise) as CacheResult<T, E> | undefined;\n}\n","import { DEBUG } from '@warp-drive/build-config/env';\nimport { getOrSetGlobal } from '@warp-drive/core-types/-private';\nimport type {\n  RequestInfo,\n  StructuredDataDocument,\n  StructuredDocument,\n  StructuredErrorDocument,\n} from '@warp-drive/core-types/request';\nimport { STRUCTURED } from '@warp-drive/core-types/request';\n\nimport { Context, ContextOwner } from './context';\nimport { assertValidRequest } from './debug';\nimport { createFuture, isFuture } from './future';\nimport { setRequestResult } from './promise-cache';\nimport type { DeferredFuture, Future, GodContext, Handler } from './types';\n\nexport const IS_CACHE_HANDLER = getOrSetGlobal('IS_CACHE_HANDLER', Symbol('IS_CACHE_HANDLER'));\nexport function curryFuture<T>(owner: ContextOwner, inbound: Future<T>, outbound: DeferredFuture<T>): Future<T> {\n  owner.setStream(inbound.getStream());\n\n  inbound.then(\n    (doc: StructuredDataDocument<T>) => {\n      const document = {\n        [STRUCTURED]: true as const,\n        request: owner.request,\n        response: doc.response,\n        content: doc.content,\n      };\n      outbound.resolve(document);\n    },\n    (error: Error & StructuredErrorDocument) => {\n      if (isDoc(error)) {\n        owner.setStream(owner.god.stream);\n      }\n      if (!error || !(error instanceof Error)) {\n        try {\n          throw new Error(error ? error : `Request Rejected with an Unknown Error`);\n        } catch (e: unknown) {\n          if (error && typeof error === 'object') {\n            Object.assign(e as Error, error);\n            (e as Error & StructuredErrorDocument).message =\n              (error as Error).message || `Request Rejected with an Unknown Error`;\n          }\n          error = e as Error & StructuredErrorDocument;\n        }\n      }\n\n      error[STRUCTURED] = true;\n      error.request = owner.request;\n      error.response = owner.getResponse();\n      error.error = error.error || error.message;\n\n      outbound.reject(error);\n    }\n  );\n  return outbound.promise;\n}\n\nfunction isDoc<T>(doc: T | StructuredDataDocument<T>): doc is StructuredDataDocument<T> {\n  return doc && (doc as StructuredDataDocument<T>)[STRUCTURED] === true;\n}\n\nfunction ensureDoc<T>(owner: ContextOwner, content: T | Error, isError: boolean): StructuredDocument<T> {\n  if (isDoc(content)) {\n    return content as StructuredDocument<T>;\n  }\n\n  if (isError) {\n    return {\n      [STRUCTURED]: true,\n      request: owner.request,\n      response: owner.getResponse(),\n      error: content as Error,\n    } as StructuredErrorDocument<T>;\n  }\n\n  return {\n    [STRUCTURED]: true,\n    request: owner.request,\n    response: owner.getResponse(),\n    content: content as T,\n  };\n}\n\nexport type HttpErrorProps = {\n  code: number;\n  name: string;\n  status: number;\n  statusText: string;\n  isRequestError: boolean;\n};\n\nexport function enhanceReason(reason?: string) {\n  return new DOMException(reason || 'The user aborted a request.', 'AbortError');\n}\n\nexport function handleOutcome<T>(\n  owner: ContextOwner,\n  inbound: Promise<T | StructuredDataDocument<T>>,\n  outbound: DeferredFuture<T>\n): Future<T> {\n  inbound.then(\n    (content: T | StructuredDataDocument<T>) => {\n      if (owner.controller.signal.aborted) {\n        // the next function did not respect the signal, we handle it here\n        outbound.reject(enhanceReason(owner.controller.signal.reason as string));\n        return;\n      }\n      if (isDoc(content)) {\n        owner.setStream(owner.god.stream);\n        content = content.content;\n      }\n      const document = {\n        [STRUCTURED]: true as const,\n        request: owner.request,\n        response: owner.getResponse(),\n        content,\n      };\n      outbound.resolve(document);\n    },\n    (error: Error & StructuredErrorDocument) => {\n      if (isDoc(error)) {\n        owner.setStream(owner.god.stream);\n      }\n      if (!error || !(error instanceof Error)) {\n        try {\n          throw new Error(error ? error : `Request Rejected with an Unknown Error`);\n        } catch (e: unknown) {\n          if (error && typeof error === 'object') {\n            Object.assign(e as Error, error);\n            (e as Error & StructuredErrorDocument).message =\n              (error as Error).message || `Request Rejected with an Unknown Error`;\n          }\n          error = e as Error & StructuredErrorDocument;\n        }\n      }\n\n      error[STRUCTURED] = true;\n      error.request = owner.request;\n      error.response = owner.getResponse();\n      error.error = error.error || error.message;\n      outbound.reject(error);\n    }\n  );\n  return outbound.promise;\n}\n\nfunction isCacheHandler(handler: Handler & { [IS_CACHE_HANDLER]?: boolean }, index: number): boolean {\n  return index === 0 && Boolean(handler[IS_CACHE_HANDLER]);\n}\n\nexport function executeNextHandler<T>(\n  wares: Readonly<Handler[]>,\n  request: RequestInfo,\n  i: number,\n  god: GodContext\n): Future<T> {\n  if (DEBUG) {\n    if (i === wares.length) {\n      throw new Error(`No handler was able to handle this request.`);\n    }\n    assertValidRequest(request, false);\n  }\n  const owner = new ContextOwner(request, god, i === 0);\n\n  function next(r: RequestInfo): Future<T> {\n    owner.nextCalled++;\n    return executeNextHandler(wares, r, i + 1, god);\n  }\n\n  const context = new Context(owner);\n  let outcome: Promise<T | StructuredDataDocument<T>> | Future<T>;\n  try {\n    outcome = wares[i].request<T>(context, next);\n    if (!!outcome && isCacheHandler(wares[i], i)) {\n      if (!(outcome instanceof Promise)) {\n        setRequestResult(owner.requestId, { isError: false, result: ensureDoc(owner, outcome, false) });\n        outcome = Promise.resolve(outcome);\n      }\n    } else if (DEBUG) {\n      if (!outcome || (!(outcome instanceof Promise) && !(typeof outcome === 'object' && 'then' in outcome))) {\n        // eslint-disable-next-line no-console\n        console.log({ request, handler: wares[i], outcome });\n        if (outcome === undefined) {\n          throw new Error(`Expected handler.request to return a promise, instead received undefined.`);\n        }\n        throw new Error(`Expected handler.request to return a promise, instead received a synchronous value.`);\n      }\n    }\n  } catch (e) {\n    if (isCacheHandler(wares[i], i)) {\n      setRequestResult(owner.requestId, { isError: true, result: ensureDoc(owner, e, true) });\n    }\n    outcome = Promise.reject<StructuredDataDocument<T>>(e);\n  }\n  const future = createFuture<T>(owner);\n\n  if (isFuture<T>(outcome)) {\n    return curryFuture(owner, outcome, future);\n  }\n\n  return handleOutcome(owner, outcome, future);\n}\n","import { IS_FUTURE, type StructuredDocument } from '@warp-drive/core-types/request';\n\nimport type { ContextOwner } from './context';\nimport type { Deferred, DeferredFuture, Future } from './types';\nimport { enhanceReason } from './utils';\n\nexport function isFuture<T>(maybe: unknown): maybe is Future<T> {\n  return Boolean(maybe && maybe instanceof Promise && (maybe as Future<T>)[IS_FUTURE] === true);\n}\n\nexport function createDeferred<T>(): Deferred<T> {\n  let resolve!: (v: T) => void;\n  let reject!: (v: unknown) => void;\n  const promise = new Promise<T>((res, rej) => {\n    resolve = res;\n    reject = rej;\n  });\n  return { resolve, reject, promise };\n}\n\nexport function upgradePromise<T>(promise: Promise<StructuredDocument<T>>, future: Future<T>): Future<T> {\n  (promise as Future<T>)[IS_FUTURE] = true;\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  (promise as Future<T>).getStream = future.getStream;\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  (promise as Future<T>).abort = future.abort;\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  (promise as Future<T>).onFinalize = future.onFinalize;\n\n  return promise as Future<T>;\n}\n\nexport function createFuture<T>(owner: ContextOwner): DeferredFuture<T> {\n  const deferred = createDeferred<T>() as unknown as DeferredFuture<T>;\n  let { promise } = deferred;\n  let cbs: Array<() => void> | undefined;\n  promise = promise.finally(() => {\n    owner.resolveStream();\n    if (cbs) {\n      cbs.forEach((cb) => cb());\n    }\n  }) as Future<T>;\n  promise.onFinalize = (fn: () => void) => {\n    cbs = cbs || [];\n    cbs.push(fn);\n  };\n  promise[IS_FUTURE] = true;\n  promise.getStream = () => {\n    return owner.getStream();\n  };\n  promise.abort = (reason?: string) => {\n    owner.abort(enhanceReason(reason));\n  };\n  deferred.promise = promise;\n  return deferred;\n}\n","import { DEBUG } from '@warp-drive/build-config/env';\nimport type { ImmutableHeaders, ImmutableRequestInfo, RequestInfo, ResponseInfo } from '@warp-drive/core-types/request';\nimport { SkipCache } from '@warp-drive/core-types/request';\n\nimport { deepFreeze } from './debug';\nimport { createDeferred } from './future';\nimport type { DeferredStream, GodContext } from './types';\n\nexport function upgradeHeaders(headers: Headers | ImmutableHeaders): ImmutableHeaders {\n  (headers as ImmutableHeaders).clone = () => {\n    return new Headers(headers);\n  };\n  (headers as ImmutableHeaders).toJSON = () => {\n    return Array.from(headers);\n  };\n  return headers as ImmutableHeaders;\n}\n\nexport function cloneResponseProperties(response: Response): ResponseInfo {\n  const { headers, ok, redirected, status, statusText, type, url } = response;\n  upgradeHeaders(headers);\n  return {\n    headers: headers as ImmutableHeaders,\n    ok,\n    redirected,\n    status,\n    statusText,\n    type,\n    url,\n  };\n}\n\nexport class ContextOwner {\n  hasSetStream = false;\n  hasSetResponse = false;\n  hasSubscribers = false;\n  stream: DeferredStream = createDeferred<ReadableStream | null>();\n  response: ResponseInfo | null = null;\n  declare request: ImmutableRequestInfo;\n  declare enhancedRequest: ImmutableRequestInfo;\n  nextCalled = 0;\n  declare god: GodContext;\n  declare controller: AbortController;\n  declare requestId: number;\n  declare isRoot: boolean;\n\n  constructor(request: RequestInfo, god: GodContext, isRoot = false) {\n    this.isRoot = isRoot;\n    this.requestId = god.id;\n    this.controller = request.controller || god.controller;\n    this.stream.promise.sizeHint = 0;\n\n    if (request.controller) {\n      if (request.controller !== god.controller) {\n        god.controller.signal.addEventListener('abort', () => {\n          this.controller.abort(god.controller.signal.reason);\n        });\n      }\n      delete request.controller;\n    }\n    let enhancedRequest: ImmutableRequestInfo = Object.assign(\n      { signal: this.controller.signal },\n      request\n    ) as ImmutableRequestInfo;\n    if (DEBUG) {\n      if (!request?.cacheOptions?.[SkipCache]) {\n        request = deepFreeze(request) as ImmutableRequestInfo;\n        enhancedRequest = deepFreeze(enhancedRequest);\n      }\n    } else {\n      if (request.headers) {\n        upgradeHeaders(request.headers);\n      }\n    }\n    this.enhancedRequest = enhancedRequest;\n    this.request = request as ImmutableRequestInfo;\n    this.god = god;\n    this.stream.promise = this.stream.promise.then((stream: ReadableStream | null) => {\n      if (this.god.stream === stream && this.hasSubscribers) {\n        this.god.stream = null;\n      }\n      return stream;\n    });\n  }\n\n  get hasRequestedStream(): boolean {\n    return this.god.hasRequestedStream;\n  }\n\n  getResponse(): ResponseInfo | null {\n    if (this.hasSetResponse) {\n      return this.response;\n    }\n    if (this.nextCalled === 1) {\n      return this.god.response;\n    }\n    return null;\n  }\n  getStream(): Promise<ReadableStream | null> {\n    if (this.isRoot) {\n      this.god.hasRequestedStream = true;\n    }\n    if (!this.hasSetResponse) {\n      const hint = this.god.response?.headers?.get('content-length');\n      this.stream.promise.sizeHint = hint ? parseInt(hint, 10) : 0;\n    }\n    this.hasSubscribers = true;\n    return this.stream.promise;\n  }\n  abort(reason: DOMException) {\n    this.controller.abort(reason);\n  }\n\n  setStream(stream: ReadableStream | Promise<ReadableStream | null> | null) {\n    if (!this.hasSetStream) {\n      this.hasSetStream = true;\n\n      if (!(stream instanceof Promise)) {\n        this.god.stream = stream;\n      }\n      // @ts-expect-error\n      this.stream.resolve(stream);\n    }\n  }\n\n  resolveStream() {\n    this.setStream(this.nextCalled === 1 ? this.god.stream : null);\n  }\n\n  setResponse(response: ResponseInfo | Response | null) {\n    if (this.hasSetResponse) {\n      if (DEBUG) {\n        throw new Error(`Cannot setResponse when a response has already been set`);\n      }\n      return;\n    }\n    this.hasSetResponse = true;\n    if (response instanceof Response) {\n      // TODO potentially avoid cloning in prod\n      let responseData = cloneResponseProperties(response);\n\n      if (DEBUG) {\n        responseData = deepFreeze(responseData);\n      }\n      this.response = responseData;\n      this.god.response = responseData;\n      const sizeHint = response.headers?.get('content-length');\n      this.stream.promise.sizeHint = sizeHint ? parseInt(sizeHint, 10) : 0;\n    } else {\n      this.response = response;\n      this.god.response = response;\n    }\n  }\n}\n\nexport class Context {\n  #owner: ContextOwner;\n  declare request: ImmutableRequestInfo;\n  declare id: number;\n\n  constructor(owner: ContextOwner) {\n    this.id = owner.requestId;\n    this.#owner = owner;\n    this.request = owner.enhancedRequest;\n  }\n  setStream(stream: ReadableStream | Promise<ReadableStream | null>) {\n    this.#owner.setStream(stream);\n  }\n  setResponse(response: ResponseInfo | Response | null) {\n    this.#owner.setResponse(response);\n  }\n\n  get hasRequestedStream() {\n    return this.#owner.hasRequestedStream;\n  }\n}\nexport type HandlerRequestContext = Context;\n","import { DEBUG } from '@warp-drive/build-config/env';\nimport { getOrSetGlobal } from '@warp-drive/core-types/-private';\nimport type { ImmutableHeaders, RequestInfo } from '@warp-drive/core-types/request';\n\nimport { Context, upgradeHeaders } from './context';\n\nconst BODY_TYPES = {\n  type: 'string',\n  klass: ['Blob', 'ArrayBuffer', 'TypedArray', 'DataView', 'FormData', 'URLSearchParams', 'ReadableStream'],\n};\nconst ValidKeys = new Map<string, string | string[] | typeof BODY_TYPES>([\n  ['records', 'array'],\n  ['data', 'json'],\n  ['body', BODY_TYPES],\n  ['disableTestWaiter', 'boolean'],\n  ['options', 'object'],\n  ['cacheOptions', 'object'],\n  ['op', 'string'],\n  ['store', 'object'],\n  ['url', 'string'],\n  ['cache', ['default', 'force-cache', 'no-cache', 'no-store', 'only-if-cached', 'reload']],\n  ['credentials', ['include', 'omit', 'same-origin']],\n  [\n    'destination',\n    [\n      '',\n      'object',\n      'audio',\n      'audioworklet',\n      'document',\n      'embed',\n      'font',\n      'frame',\n      'iframe',\n      'image',\n      'manifest',\n      'paintworklet',\n      'report',\n      'script',\n      'sharedworker',\n      'style',\n      'track',\n      'video',\n      'worker',\n      'xslt',\n    ],\n  ],\n  ['headers', 'headers'],\n  ['integrity', 'string'],\n  ['keepalive', 'boolean'],\n  ['method', ['GET', 'PUT', 'PATCH', 'DELETE', 'POST', 'OPTIONS']],\n  ['mode', ['same-origin', 'cors', 'navigate', 'no-cors']],\n  ['redirect', ['error', 'follow', 'manual']],\n  ['referrer', 'string'],\n  ['signal', 'AbortSignal'],\n  ['controller', 'AbortController'],\n  [\n    'referrerPolicy',\n    [\n      '',\n      'same-origin',\n      'no-referrer',\n      'no-referrer-when-downgrade',\n      'origin',\n      'origin-when-cross-origin',\n      'strict-origin',\n      'strict-origin-when-cross-origin',\n      'unsafe-url',\n    ],\n  ],\n]);\n\nconst IS_FROZEN = getOrSetGlobal('IS_FROZEN', Symbol('FROZEN'));\nconst IS_COLLECTION = getOrSetGlobal('IS_COLLECTION', Symbol.for('Collection'));\n\nfunction freezeHeaders(headers: Headers | ImmutableHeaders): ImmutableHeaders {\n  headers.delete =\n    headers.set =\n    headers.append =\n      () => {\n        throw new Error(`Cannot Mutate Immutatable Headers, use headers.clone to get a copy`);\n      };\n  upgradeHeaders(headers);\n  return headers as ImmutableHeaders;\n}\n\nexport function deepFreeze<T = unknown>(value: T): T {\n  if (value && (value as { [IS_FROZEN]?: true })[IS_FROZEN]) {\n    return value;\n  }\n  const _type = typeof value;\n  switch (_type) {\n    case 'boolean':\n    case 'string':\n    case 'number':\n    case 'symbol':\n    case 'undefined':\n    case 'bigint':\n      return value;\n    case 'function':\n      throw new Error(`Cannot deep-freeze a function`);\n    case 'object': {\n      const _niceType = niceTypeOf(value);\n      switch (_niceType) {\n        case 'array': {\n          if ((value as unknown[] & { [IS_COLLECTION]?: true })[IS_COLLECTION]) {\n            return value;\n          }\n          const arr = (value as unknown[]).map(deepFreeze);\n          arr[IS_FROZEN as unknown as number] = true;\n          return Object.freeze(arr) as T;\n        }\n        case 'null':\n          return value;\n        case 'object':\n          Object.keys(value as Record<string, unknown>).forEach((key) => {\n            try {\n              (value as Record<string, unknown>)[key] = deepFreeze((value as Record<string, unknown>)[key]) as object;\n            } catch {\n              // continue\n            }\n          });\n          (value as Record<string | symbol, unknown>)[IS_FROZEN] = true;\n          return Object.freeze(value);\n        case 'headers':\n          return freezeHeaders(value as Headers) as T;\n        case 'Collection':\n        case 'Store':\n        case 'AbortSignal':\n          return value;\n        case 'date':\n        case 'map':\n        case 'set':\n        case 'error':\n        case 'stream':\n        default:\n          // console.log(`Cannot deep-freeze ${_niceType}`);\n          return value;\n      }\n    }\n  }\n}\n\nfunction isMaybeContext(request: unknown) {\n  if (request && typeof request === 'object') {\n    const keys = Object.keys(request);\n    if (keys.length === 1 && keys[0] === 'request') {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction niceTypeOf(v: unknown) {\n  if (v === null) {\n    return 'null';\n  }\n  if (typeof v === 'string') {\n    return v ? 'non-empty-string' : 'empty-string';\n  }\n  if (!v) {\n    return typeof v;\n  }\n  if (Array.isArray(v)) {\n    return 'array';\n  }\n  if (v instanceof Date) {\n    return 'date';\n  }\n  if (v instanceof Map) {\n    return 'map';\n  }\n  if (v instanceof Set) {\n    return 'set';\n  }\n  if (v instanceof Error) {\n    return 'error';\n  }\n  if (v instanceof ReadableStream || v instanceof WritableStream || v instanceof TransformStream) {\n    return 'stream';\n  }\n  if (v instanceof Headers) {\n    return 'headers';\n  }\n  if (typeof v === 'object' && v.constructor && v.constructor.name !== 'Object') {\n    return v.constructor.name;\n  }\n  return typeof v;\n}\n\nfunction validateKey(key: string, value: unknown, errors: string[]) {\n  const schema = ValidKeys.get(key);\n  if (!schema && !IgnoredKeys.has(key)) {\n    errors.push(`InvalidKey: '${key}'`);\n    return;\n  }\n  if (schema) {\n    if (schema === BODY_TYPES) {\n      if (typeof value === 'string' || value instanceof ReadableStream) {\n        return;\n      }\n      const type = niceTypeOf(value);\n      if (schema.klass.includes(type)) {\n        return;\n      }\n      errors.push(\n        `InvalidValue: key 'body' should be a string or one of '${schema.klass.join(\"', '\")}', received ${\n          '<a value of type ' + niceTypeOf(value) + '>'\n        }`\n      );\n      return;\n    }\n    if (Array.isArray(schema)) {\n      if (!schema.includes(value as string)) {\n        errors.push(\n          `InvalidValue: key ${key} should be a one of '${schema.join(\"', '\")}', received ${\n            typeof value === 'string' ? value : '<a value of type ' + niceTypeOf(value) + '>'\n          }`\n        );\n      }\n      return;\n    } else if (schema === 'json') {\n      try {\n        JSON.stringify(value);\n      } catch (e) {\n        errors.push(\n          `InvalidValue: key ${key} should be a JSON serializable value, but failed to serialize with Error - ${\n            (e as Error).message\n          }`\n        );\n      }\n      return;\n    } else if (schema === 'headers') {\n      if (!(value instanceof Headers)) {\n        errors.push(`InvalidValue: key ${key} should be an instance of Headers, received ${niceTypeOf(value)}`);\n      }\n      return;\n    } else if (schema === 'record') {\n      const _type = typeof value;\n      // record must extend plain object or Object.create(null)\n      if (!value || _type !== 'object' || (value.constructor && value.constructor !== Object)) {\n        errors.push(\n          `InvalidValue: key ${key} should be a dictionary of string keys to string values, received ${niceTypeOf(\n            value\n          )}`\n        );\n        return;\n      }\n      const keys = Object.keys(value);\n      keys.forEach((k) => {\n        const v: unknown = (value as Record<string, unknown>)[k];\n        if (typeof k !== 'string') {\n          errors.push(`\\tThe key ${String(k)} on ${key} should be a string key`);\n        } else if (typeof v !== 'string') {\n          errors.push(`\\tThe value of ${key}.${k} should be a string not ${niceTypeOf(v)}`);\n        }\n      });\n      return;\n    } else if (schema === 'string') {\n      if (typeof value !== 'string' || value.length === 0) {\n        errors.push(\n          `InvalidValue: key ${key} should be a non-empty string, received ${\n            typeof value === 'string' ? \"''\" : typeof value\n          }`\n        );\n      }\n      return;\n    } else if (schema === 'object') {\n      if (!value || Array.isArray(value) || typeof value !== 'object') {\n        errors.push(`InvalidValue: key ${key} should be an object`);\n      }\n      return;\n    } else if (schema === 'boolean') {\n      if (typeof value !== 'boolean') {\n        errors.push(`InvalidValue: key ${key} should be a boolean, received ${typeof value}`);\n      }\n      return;\n    } else if (schema === 'array') {\n      if (!Array.isArray(value)) {\n        errors.push(`InvalidValue: key ${key} should be an array, received ${typeof value}`);\n      }\n      return;\n    }\n  }\n}\n\nconst IgnoredKeys = new Set<string>([]);\n\nexport function assertValidRequest(\n  request: RequestInfo | Context,\n  isTopLevel: boolean\n): asserts request is RequestInfo {\n  if (DEBUG) {\n    // handle basic shape\n    if (!request) {\n      throw new Error(\n        `Expected ${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>) to be called with a request, but none was provided.`\n      );\n    }\n    if (Array.isArray(request) || typeof request !== 'object') {\n      throw new Error(\n        `The \\`request\\` passed to \\`${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>)\\` should be an object, received \\`${niceTypeOf(request)}\\``\n      );\n    }\n    if (Object.keys(request).length === 0) {\n      throw new Error(\n        `The \\`request\\` passed to \\`${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>)\\` was empty (\\`{}\\`). Requests need at least one valid key.`\n      );\n    }\n\n    // handle accidentally passing context entirely\n    if (request instanceof Context) {\n      throw new Error(\n        `Expected a request passed to \\`${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>)\\` but received the previous handler's context instead`\n      );\n    }\n    // handle Object.assign({}, context);\n    if (isMaybeContext(request)) {\n      throw new Error(\n        `Expected a request passed to \\`${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>)\\` but received an object with a request key instead.`\n      );\n    }\n\n    // handle schema\n    const keys = Object.keys(request) as Array<keyof RequestInfo>;\n    const validationErrors: string[] = [];\n    const isLegacyRequest = Boolean('op' in request && !request.url);\n    keys.forEach((key) => {\n      if (isLegacyRequest && key === 'data') {\n        return;\n      }\n      validateKey(key, request[key], validationErrors);\n    });\n    if (validationErrors.length) {\n      const error: Error & { errors: string[] } = new Error(\n        `Invalid Request passed to \\`${\n          isTopLevel ? 'RequestManager.request' : 'next'\n        }(<request>)\\`.\\n\\nThe following issues were found:\\n\\n\\t${validationErrors.join('\\n\\t')}`\n      ) as Error & { errors: string[] };\n      error.errors = validationErrors;\n      throw error;\n    }\n  }\n}\n"],"names":["PromiseCache","getOrSetUniversal","WeakMap","RequestMap","Map","setRequestResult","requestId","result","set","clearRequestResult","delete","getRequestResult","get","setPromiseResult","promise","getPromiseResult","IS_CACHE_HANDLER","getOrSetGlobal","Symbol","curryFuture","owner","inbound","outbound","setStream","getStream","then","doc","document","STRUCTURED","request","response","content","resolve","error","isDoc","god","stream","Error","e","Object","assign","message","getResponse","reject","ensureDoc","isError","enhanceReason","reason","DOMException","handleOutcome","controller","signal","aborted","isCacheHandler","handler","index","Boolean","executeNextHandler","wares","i","macroCondition","getGlobalConfig","WarpDrive","env","DEBUG","length","assertValidRequest","ContextOwner","next","r","nextCalled","context","Context","outcome","Promise","console","log","undefined","future","createFuture","isFuture","maybe","IS_FUTURE","createDeferred","res","rej","upgradePromise","abort","onFinalize","deferred","cbs","finally","resolveStream","forEach","cb","fn","push","upgradeHeaders","headers","clone","Headers","toJSON","Array","from","cloneResponseProperties","ok","redirected","status","statusText","type","url","hasSetStream","hasSetResponse","hasSubscribers","constructor","isRoot","id","sizeHint","addEventListener","enhancedRequest","cacheOptions","SkipCache","deepFreeze","hasRequestedStream","hint","parseInt","setResponse","Response","responseData","BODY_TYPES","klass","ValidKeys","IS_FROZEN","IS_COLLECTION","for","freezeHeaders","append","value","_type","_niceType","niceTypeOf","arr","map","freeze","keys","key","isMaybeContext","v","isArray","Date","Set","ReadableStream","WritableStream","TransformStream","name","validateKey","errors","schema","IgnoredKeys","has","includes","join","JSON","stringify","k","String","isTopLevel","validationErrors","isLegacyRequest"],"mappings":"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"}